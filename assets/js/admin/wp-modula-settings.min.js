wp.Modula=void 0===wp.Modula?{}:wp.Modula,function(t,e){var a=Backbone.Model.extend({initialize:function(a){var i=this;t.each(a,(function(t,e){i.set(t,e)}));var n=new e.settings.view({model:this,el:t("#modula-settings")});this.set("view",n)}}),i=Backbone.View.extend({events:{"click .modula-tab":"changeTab","click .modula-tab > *":"changeTabFromChild","click .modula_settings_accordion":"changeAcordeon","keyup input":"updateModel","keyup textarea":"updateModel","change input":"updateModel","change textarea":"updateModel","blur textarea":"updateModel","change select":"updateModel"},initialize:function(t){this.initializeLite()},initializeLite:function(){this.tabs=this.$el.find(".modula-tabs .modula-tab"),this.tabContainers=this.$el.find(".modula-tabs-content > div"),this.sliders=this.$el.find(".modula-ui-slider"),this.colorPickers=this.$el.find(".modula-color"),this.customEditors=this.$el.find(".modula-code-editor"),this.initSliders(),this.initColorPickers(),this.initCustomCSS(),this.expandGalleryContainer()},updateModel:function(t){var e,a;void 0!==t.target.dataset.setting&&(a=t.target.dataset.setting,e="checkbox"==t.target.type?t.target.checked?t.target.value:0:t.target.value,this.model.set(a,e))},changeTab:function(e){var a=jQuery(e.target).data("tab");if(!(this.tabContainers.filter("#"+a).length<1)){this.tabs.removeClass("active-tab"),this.tabContainers.removeClass("active-tab"),jQuery(e.target).addClass("active-tab"),this.tabContainers.filter("#"+a).addClass("active-tab").trigger("modula-current-tab"),window.location.hash="#!"+a;var i=t("#post").attr("action");i&&(i=i.split("#")[0],t("#post").attr("action",i+window.location.hash));var n={url:modulaHelper.ajax_url,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"modula_remember_tab",tab:a,id:t("#post_ID").val(),nonce:modulaHelper._wpnonce}};t.ajax(n)}},changeTabFromChild:function(t){var e=jQuery(t.target).parent().data("tab");this.tabContainers.filter("#"+e).length<1||(this.tabs.removeClass("active-tab"),this.tabContainers.removeClass("active-tab"),jQuery(t.target).parent().addClass("active-tab"),this.tabContainers.filter("#"+e).addClass("active-tab"))},changeAcordeon:function(t){var e=jQuery(t.target).parents("tr"),a=e.data("container"),i=e.data("children"),n=wp.Modula.Settings.get(a),o=1;e.toggleClass("modula_accordion_open"),e.hasClass("modula_accordion_reversed")&&(n=0==n?1:0),e.data("parent")&&(o=this.chechParents(e[0],o)),jQuery.each(i,(function(t,a){var i=jQuery('[data-container="'+a+'"]');1==n&&1==o?(i.css("opacity","1"),i.find("input, textarea, select, button").removeAttr("disabled")):(i.css("opacity","0.5"),i.find("input, textarea, select, button").attr("disabled","disabled")),e.hasClass("modula_accordion_open")?i.show():i.hide()}));let r="toggleAccordeon:"+a;this.model.trigger("toggleAccordeon"),this.model.trigger(r)},chechParents:function(t,e){if(jQuery(t).data("parent")&&1==e){if(1!=wp.Modula.Settings.get(jQuery(t).data("parent")))return e=0,0;e=this.chechParents(jQuery('[data-container="'+jQuery(t).data("parent")+'"]'),e)}return e},initSliders:function(){this.sliders.length>0&&this.sliders.each((function(t,e){var a=jQuery(e).parent().find(".modula-ui-slider-input"),i=a.data("max"),n=a.data("min"),o=a.data("step"),r=parseInt(a.val(),10);jQuery(e).slider({value:r,min:n,max:i,step:o,range:"min",slide:function(t,e){a.val(e.value).trigger("change")}}),a.keyup((function(){jQuery(e).slider("value",a.val())}))}))},initColorPickers:function(){this.colorPickers.length>0&&this.colorPickers.each((function(t,e){jQuery(e).wpColorPicker()}))},initCustomCSS:function(){if(void 0!==wp.codeEditor){var e=wp.codeEditor.defaultSettings?_.clone(wp.codeEditor.defaultSettings):{};this.customEditors.length>0&&this.customEditors.each((function(a,i){var n=t(i).data("syntax"),o="#"+t(i).find(".modula-custom-editor-field").attr("id"),r=_.extend({},e.codemirror,{mode:n});if(void 0!==wp.codeEditor){var s=wp.codeEditor.initialize(t(o),r);t(i).parents(".modula-tab-content").on("modula-current-tab",(function(){s.codemirror.refresh()}))}}))}},expandGalleryContainer:function(){t("#modula-preview-gallery").removeClass("closed")}});e.settings={model:a,view:i}}(jQuery,wp.Modula);