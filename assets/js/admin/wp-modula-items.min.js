wp.Modula=void 0===wp.Modula?{}:wp.Modula,function(e,t){var i=Backbone.Collection.extend({updateInterval:!1,initialize:function(){this.listenTo(this,"remove",e.proxy(wp.Modula.Save.checkSave,wp.Modula.Save)),this.listenTo(this,"add",e.proxy(wp.Modula.Save.checkSave,wp.Modula.Save))},modelId:function(e){return e.id},moveItem:function(e,t){this.indexOf(e)!=t&&(this.remove(e,{silent:!0}),this.add(e,{at:t-1}))},addItem:function(e){this.add(e)}}),s=Backbone.Model.extend({defaults:{id:"",title:"",description:"",alt:"",link:"",halign:"",valign:"",target:"",togglelightbox:"",src:"",type:"image",width:2,height:2,full:"",thumbnail:"",resize:!1,index:"",orientation:"landscape"},updateInterval:!1,initialize:function(e){t.Items=void 0===t.Items?new t.items.collection:t.Items,t.Items.addItem(this),this.set("index",t.Items.indexOf(this));var i=new t.items.view({model:this,id:"modula-item-"+this.get("id")});this.set("view",i),"custom-grid"==t.Settings.get("type")&&(this.set("resize",!0),this.resize())},getAttributes:function(){var e=this.toJSON(),t={};return jQuery.each(e,(function(e,i){"object"!=typeof i&&(t[e]=i)})),t},resize:function(){var e,i,s=t.Resizer.get("size"),l=t.Resizer.get("gutter"),a=t.Resizer.get("columns"),n=this.get("width"),d=this.get("height"),r=this.get("view");parseInt(n)>parseInt(a)&&(this.set("width",a),n=a),"custom-grid"==t.Settings.get("type")&&(e=s*n+(n-1)*l,i=s*d+(d-1)*l,r.$el.width(e),r.$el.height(i)),this.get("view").render()},delete:function(){this.trigger("destroy",this,this.collection,{}),this.get("view").remove(),"custom-grid"==t.Settings.get("type")&&t.GalleryView.resetPackary()}}),l=Backbone.View.extend({tagName:"div",className:"modula-single-image",fitTimeout:!1,id:"",template:wp.template("modula-image"),events:{"click .modula-edit-image":"editImage","click .modula-delete-image":"deleteImage",resize:"resizeImage",resizestop:"resizeStop","modula:updateIndex":"updateIndex"},initialize:function(e){t.GalleryView.container.append(this.render().$el),this.listenTo(t.Settings,"change:type",this.checkSettingsType),this.listenTo(t.Items,"remove",this.actualizeIndex),this.checkGalleryType(t.Settings.get("type")),this.model.get("resize")&&(t.GalleryView.container.packery("appended",this.$el),t.GalleryView.container.packery())},editImage:function(e){e.preventDefault(),t.EditModal.open(this.model)},deleteImage:function(e){e.preventDefault(),this.model.delete()},checkSettingsType:function(e,t){this.checkGalleryType(t)},checkGalleryType:function(e){var i=this.model.get("resize"),s=this;if("custom-grid"!=e||i)"custom-grid"!=e&&i&&this.destroyResizible();else{var l,a,n=t.Resizer.get("size"),d=t.Resizer.get("gutter"),r=(t.Resizer.get("columns"),this.model.get("width")),h=this.model.get("height");s.model.set("resize",!0),l=n*r+(r-1)*d,a=n*h+(h-1)*d,this.$el.draggable(),this.initResizable(),this.$el.height(a),this.$el.width(l),t.GalleryView.bindDraggabillyEvents(s.$el),t.GalleryView.resetPackary()}s.render()},initResizable:function(){var e=t.Resizer.get("size");this.$el.resizable({handles:{se:this.$(".segrip")},minHeight:e,minWidth:e,maxWidth:t.Resizer.get("containerSize"),helper:"ui-resizable-helper"})},resizeImage:function(i,s){e(i.target).css("z-index","999");var l=t.Resizer.calculateSize(s.size.width),a=t.Resizer.calculateSize(s.size.height);s.helper.width(l),s.helper.height(a),s.element.width(s.size.width),s.element.height(s.size.height)},resizeStop:function(i,s){e(i.target).css("z-index","auto");var l=s.size.width,a=s.size.height,n=t.Resizer.calculateSize(l),d=t.Resizer.calculateSize(a);this.$el.width(n),this.$el.height(d),this.model.set("width",t.Resizer.getSizeColumns(l)),this.model.set("height",t.Resizer.getSizeColumns(a)),this.render(),wp.Modula.Save.saveImages(),t.GalleryView.resetPackary()},destroyResizible:function(){this.model.set("resize",!1),this.$el.draggable("destroy"),this.$el.resizable("destroy"),this.$el.removeAttr("style")},updateIndex:function(e,i){this.model.set("index",i.index),t.Items.moveItem(this.model,i.index),this.render()},actualizeIndex:function(e,i){var s=this.model.get("index"),l=t.Items.indexOf(this.model);-1!=l&&s!=l&&(this.model.set("index",l),this.render())},render:function(){return this.$el.is(".ui-resizable")&&this.$el.resizable("destroy"),this.$el.html(this.template(this.model.attributes)),this.model.get("resize")&&this.initResizable(),this}});t.items={collection:i,model:s,view:l}}(jQuery,wp.Modula);