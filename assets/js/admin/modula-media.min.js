function ModulaMakeItem(e){return new_item={id:"",title:"",description:"",alt:"",link:"",halign:"center",valign:"middle",target:"",togglelightbox:"",hide_title:"",src:"",type:"image",width:2,height:2,full:"",thumbnail:"",resize:!1,index:"",orientation:"landscape"},new_item.id=e.attributes.id,new_item.title=e.attributes.name,new_item.description=e.attributes.caption,new_item.alt=e.attributes.alt,new_item.width=e.attributes.width,new_item.width=e.attributes.height,new_item.type=e.attributes.type,new_item}jQuery(document).ready((function(e){var t=e("#bulk-action-selector-top"),l=e("#bulk-action-selector-bottom"),i=wp.template("modula-gallery-selector");void 0!==modulaGalleries.posts&&0!=modulaGalleries.posts.length&&(void 0!==t[0]&&(modulaGalleries.pos="top",t.after(i(modulaGalleries))),void 0!==l[0]&&(modulaGalleries.pos="bottom",l.after(i(modulaGalleries)))),e(document).on("change","#bulk-action-selector-top, #bulk-action-selector-bottom",(function(){"modula_add_to_gallery"==e(this).val()?e("#modula_gallery_select_top, #modula_gallery_select_bottom").show():e("#modula_gallery_select_top, #modula_gallery_select_bottom").hide()}));var o,a=wp.media.view.Button;o=a.extend({initialize:function(){a.prototype.initialize.apply(this,arguments),this.options.filters&&this.options.filters.model.on("change",this.filterChange,this),this.controller.on("selection:toggle",this.toggleDisabled,this),this.controller.on("select:activate",this.toggleDisabled,this)},toggleDisabled:function(){this.model.set("disabled",!this.controller.state().get("selection").length)},render:function(){return a.prototype.render.apply(this,arguments),this.controller.isModeActive("select")?this.$el.addClass("delete-selected-button"):this.$el.addClass("delete-selected-button hidden"),this.toggleDisabled(),this}}),ModulaGallerySelector=wp.media.View.extend({className:"view-switch wp-modula-gallery-selector",template:wp.template("modula-gallery-selector"),initialize:function(){this.controller.on("selection:toggle",this.toggleDisabled,this),this.controller.on("select:activate",this.toggleDisabled,this),this.controller.on("select:deactivate",this.toggleDisabled,this)},toggleDisabled:function(){this.controller.isModeActive("select")?this.$el.show():this.$el.hide(),0==this.controller.state().get("selection").length?this.$el.find("select").prop("disabled",!0):this.$el.find("select").prop("disabled",!1)},render:function(){return this.$el.html(this.template(modulaGalleries.posts)),this.controller.isModeActive("select")?this.$el.addClass("view-switch wp-modula-gallery-selector"):this.$el.addClass("view-switch wp-modula-gallery-selector hidden"),this.toggleDisabled(),this}}),wp.media.view.modulaGallerySelector=ModulaGallerySelector,wp.media.view.addToGalleryBtn=o;var s=wp.media.view.AttachmentsBrowser;wp.media.view.AttachmentsBrowser=s.extend({createToolbar:function(){if(s.prototype.createToolbar.apply(this,arguments),void 0!==modulaGalleries.posts&&0!=modulaGalleries.posts.length){var t=this.toolbar,l=this.toolbar.get("filters");t.set("modulaGallerySelector",new ModulaGallerySelector({filters:l,style:"primary",controller:this.controller,priority:-181}).render()),t.set("addToGalleryBtn",new wp.media.view.addToGalleryBtn({filters:l,style:"primary",text:"Add to Modula Gallery",controller:this.controller,priority:-180,click:function(){var t=[],l=this.controller.state().get("selection"),i=this.controller.state().get("library");if(l.length)if(l.each((function(e){"trash"!==e.get("status")&&t.push(ModulaMakeItem(e))})),t.length){var o=e("#modula_gallery_select").val(),a=modulaGalleries.nonce;e.ajax({url:modulaGalleries.ajax_url,type:"POST",dataType:"json",data:{action:"add_images_to_gallery",selected:JSON.stringify(t),gallery_id:o,nonce:a},success:function(t){t.success?(i._requery(!0),window.modulaEventBus.emit("modula:media:insert:done"),e(document).trigger("modula:media:insert:done",t.data),this.controller.trigger("selection:action:done")):alert(modulaGalleries.l10n.ajax_failed+t.data)}.bind(this),error:function(e,t,l){alert(modulaGalleries.l10n.ajax_failed+l)}})}else this.controller.trigger("selection:action:done")}}).render())}}})}));