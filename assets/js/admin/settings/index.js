(()=>{"use strict";var t={20:(t,e,s)=>{var i=s(609),r=Symbol.for("react.element"),n=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,o=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};e.Fragment=n,e.jsx=function(t,e,s){var i,n={},l=null,c=null;for(i in void 0!==s&&(l=""+s),void 0!==e.key&&(l=""+e.key),void 0!==e.ref&&(c=e.ref),e)a.call(e,i)&&!u.hasOwnProperty(i)&&(n[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps)void 0===n[i]&&(n[i]=e[i]);return{$$typeof:r,type:t,key:l,ref:c,props:n,_owner:o.current}}},848:(t,e,s)=>{t.exports=s(20)},493:(t,e,s)=>{var i=s(609),r="function"==typeof Object.is?Object.is:function(t,e){return t===e&&(0!==t||1/t==1/e)||t!=t&&e!=e},n=i.useState,a=i.useEffect,o=i.useLayoutEffect,u=i.useDebugValue;function l(t){var e=t.getSnapshot;t=t.value;try{var s=e();return!r(t,s)}catch(t){return!0}}var c="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(t,e){return e()}:function(t,e){var s=e(),i=n({inst:{value:s,getSnapshot:e}}),r=i[0].inst,c=i[1];return o((function(){r.value=s,r.getSnapshot=e,l(r)&&c({inst:r})}),[t,s,e]),a((function(){return l(r)&&c({inst:r}),t((function(){l(r)&&c({inst:r})}))}),[t]),u(s),s};e.useSyncExternalStore=void 0!==i.useSyncExternalStore?i.useSyncExternalStore:c},162:(t,e,s)=>{var i=s(609),r=s(888),n="function"==typeof Object.is?Object.is:function(t,e){return t===e&&(0!==t||1/t==1/e)||t!=t&&e!=e},a=r.useSyncExternalStore,o=i.useRef,u=i.useEffect,l=i.useMemo,c=i.useDebugValue;e.useSyncExternalStoreWithSelector=function(t,e,s,i,r){var h=o(null);if(null===h.current){var d={hasValue:!1,value:null};h.current=d}else d=h.current;h=l((function(){function t(t){if(!u){if(u=!0,a=t,t=i(t),void 0!==r&&d.hasValue){var e=d.value;if(r(e,t))return o=e}return o=t}if(e=o,n(a,t))return e;var s=i(t);return void 0!==r&&r(e,s)?(a=t,e):(a=t,o=s)}var a,o,u=!1,l=void 0===s?null:s;return[function(){return t(e())},null===l?void 0:function(){return t(l())}]}),[e,s,i,r]);var f=a(t,h[0],h[1]);return u((function(){d.hasValue=!0,d.value=f}),[f]),c(f),f}},888:(t,e,s)=>{t.exports=s(493)},242:(t,e,s)=>{t.exports=s(162)},609:t=>{t.exports=window.React}},e={};function s(i){var r=e[i];if(void 0!==r)return r.exports;var n=e[i]={exports:{}};return t[i](n,n.exports,s),n.exports}s.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return s.d(e,{a:e}),e},s.d=(t,e)=>{for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var i=s(609);const r=window.wp.element,n=window.wp.components,a=window.wp.i18n,o="bTcx1n2y8X8R4LPk3TCL";var u=s(848);function l(t,e){return"function"==typeof t?t(e):t}function c(t,e){return g(e).reduce(((t,e)=>null===t?null:void 0!==t?t[e]:void 0),t)}function h(t,e,s){const i=g(e);return function t(e){if(!i.length)return l(s,e);const r=i.shift();if("string"==typeof r||"number"==typeof r&&!Array.isArray(e))return"object"==typeof e?(null===e&&(e={}),{...e,[r]:t(e[r])}):{[r]:t()};if(Array.isArray(e)&&"number"==typeof r){const s=e.slice(0,r);return[...s.length?s:new Array(r),t(e[r]),...e.slice(r+1)]}return[...new Array(r),t()]}(t)}const d=/^(\d*)$/gm,f=/\.(\d*)\./gm,p=/^(\d*)\./gm,v=/\.(\d*$)/gm,y=/\.{2,}/gm,m="__int__",b=`${m}$1`;function g(t){if(Array.isArray(t))return[...t];if("string"!=typeof t)throw new Error("Path must be a string.");return t.replaceAll("[",".").replaceAll("]","").replace(d,b).replace(f,`.${b}.`).replace(p,`${b}.`).replace(v,`.${b}`).replace(y,".").split(".").map((t=>0===t.indexOf(m)?parseInt(t.substring(m.length),10):t))}function S(t,e){const{asyncDebounceMs:s}=e,{onChangeAsync:i,onBlurAsync:r,onSubmitAsync:n,onBlurAsyncDebounceMs:a,onChangeAsyncDebounceMs:o}=e.validators||{},u=s??0,l={cause:"change",validate:i,debounceMs:o??u},c={cause:"blur",validate:r,debounceMs:a??u},h={cause:"submit",validate:n,debounceMs:0},d=t=>({...t,debounceMs:0});switch(t){case"submit":return[d(l),d(c),h];case"blur":return[c];case"change":return[l];default:return[]}}function M(t,e){const{onChange:s,onBlur:i,onSubmit:r,onMount:n}=e.validators||{},a={cause:"change",validate:s},o={cause:"blur",validate:i},u={cause:"submit",validate:r},l={cause:"mount",validate:n},c={cause:"server",validate:()=>{}};switch(t){case"mount":return[l];case"submit":return[a,o,u,c];case"server":return[c];case"blur":return[o,c];default:return[a,c]}}class w{constructor(t,e){this.listeners=new Set,this.subscribe=t=>{var e,s;this.listeners.add(t);const i=null==(s=null==(e=this.options)?void 0:e.onSubscribe)?void 0:s.call(e,t,this);return()=>{this.listeners.delete(t),null==i||i()}},this.setState=t=>{var e,s,i;this.prevState=this.state,this.state=(null==(e=this.options)?void 0:e.updateFn)?this.options.updateFn(this.prevState)(t):t(this.prevState),null==(i=null==(s=this.options)?void 0:s.onUpdate)||i.call(s),T(this)},this.prevState=t,this.state=t,this.options=e}}class O{constructor(t){this.listeners=new Set,this._subscriptions=[],this.lastSeenDepValues=[],this.getDepVals=()=>{const t=[],e=[];for(const s of this.options.deps)t.push(s.prevState),e.push(s.state);return this.lastSeenDepValues=e,{prevDepVals:t,currDepVals:e,prevVal:this.prevState??void 0}},this.recompute=()=>{var t,e;this.prevState=this.state;const{prevDepVals:s,currDepVals:i,prevVal:r}=this.getDepVals();this.state=this.options.fn({prevDepVals:s,currDepVals:i,prevVal:r}),null==(e=(t=this.options).onUpdate)||e.call(t)},this.checkIfRecalculationNeededDeeply=()=>{for(const t of this.options.deps)t instanceof O&&t.checkIfRecalculationNeededDeeply();let t=!1;const e=this.lastSeenDepValues,{currDepVals:s}=this.getDepVals();for(let i=0;i<s.length;i++)if(s[i]!==e[i]){t=!0;break}t&&this.recompute()},this.mount=()=>(this.registerOnGraph(),this.checkIfRecalculationNeededDeeply(),()=>{this.unregisterFromGraph();for(const t of this._subscriptions)t()}),this.subscribe=t=>{var e,s;this.listeners.add(t);const i=null==(s=(e=this.options).onSubscribe)?void 0:s.call(e,t,this);return()=>{this.listeners.delete(t),null==i||i()}},this.options=t,this.state=t.fn({prevDepVals:void 0,prevVal:void 0,currDepVals:this.getDepVals().currDepVals})}registerOnGraph(t=this.options.deps){for(const e of t)if(e instanceof O)e.registerOnGraph(),this.registerOnGraph(e.options.deps);else if(e instanceof w){let t=R.get(e);t||(t=new Set,R.set(e,t)),t.add(this);let s=F.get(this);s||(s=new Set,F.set(this,s)),s.add(e)}}unregisterFromGraph(t=this.options.deps){for(const e of t)if(e instanceof O)this.unregisterFromGraph(e.options.deps);else if(e instanceof w){const t=R.get(e);t&&t.delete(this);const s=F.get(this);s&&s.delete(e)}}}const R=new WeakMap,F=new WeakMap,E={current:[]};let C=!1,A=0;const V=new Set,P=new Map;function D(t){const e=Array.from(t).sort(((t,e)=>t instanceof O&&t.options.deps.includes(e)?1:e instanceof O&&e.options.deps.includes(t)?-1:0));for(const t of e){if(E.current.includes(t))continue;E.current.push(t),t.recompute();const e=F.get(t);if(e)for(const t of e){const e=R.get(t);e&&D(e)}}}function I(t){t.listeners.forEach((e=>e({prevVal:t.prevState,currentVal:t.state})))}function x(t){t.listeners.forEach((e=>e({prevVal:t.prevState,currentVal:t.state})))}function T(t){if(A>0&&!P.has(t)&&P.set(t,t.prevState),V.add(t),!(A>0||C))try{for(C=!0;V.size>0;){const t=Array.from(V);V.clear();for(const e of t){const t=P.get(e)??e.prevState;e.prevState=t,I(e)}for(const e of t){const t=R.get(e);t&&(E.current.push(e),D(t))}for(const e of t){const t=R.get(e);if(t)for(const e of t)x(e)}}}finally{C=!1,E.current=[],P.clear()}}function q(t){A++;try{t()}finally{if(A--,0===A){const t=Array.from(V)[0];t&&T(t)}}}function Q(t,e){const s=new Map;for(const e of t){const t=[...e.path??[]].map((t=>{const e="object"==typeof t?t.key:t;return"number"==typeof e?`[${e}]`:e})).join(".").replace(/\.\[/g,"[");s.set(t,(s.get(t)??[]).concat(e))}const i={};return s.forEach(((t,s)=>{i[s]=e(t)})),i}const _=(t={})=>()=>{const e=t.transformErrors??(t=>t.map((t=>t.message)).join(", ")),s=t=>{return"form"===t?(s=e,t=>({form:s(t),fields:Q(t,s)})):e;var s};return{validate({value:t,validationSource:e},i){const r=i["~standard"].validate(t);if(r instanceof Promise)throw new Error("async function passed to sync validator");if(r.issues)return s(e)(r.issues)},async validateAsync({value:t,validationSource:e},i){const r=await i["~standard"].validate(t);if(r.issues)return s(e)(r.issues)}}},j=t=>!!t&&"~standard"in t;function k(t){return{values:t.values??{},errorMap:t.errorMap??{},fieldMetaBase:t.fieldMetaBase??{},isSubmitted:t.isSubmitted??!1,isSubmitting:t.isSubmitting??!1,isValidating:t.isValidating??!1,submissionAttempts:t.submissionAttempts??0,validationMetaMap:t.validationMetaMap??{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0}}}class U{constructor(t){var e;this.options={},this.fieldInfo={},this.prevTransformArray=[],this.mount=()=>{const t=this.fieldMetaDerived.mount(),e=this.store.mount(),s=()=>{t(),e()},{onMount:i}=this.options.validators||{};return i?(this.validateSync("mount"),s):s},this.update=t=>{if(!t)return;const e=this.options;this.options=t,q((()=>{const s=t.defaultValues&&t.defaultValues!==e.defaultValues&&!this.state.isTouched,i=t.defaultState!==e.defaultState&&!this.state.isTouched;this.baseStore.setState((()=>k(Object.assign({},this.state,i?t.defaultState:{},s?{values:t.defaultValues}:{}))))}))},this.reset=(t,e)=>{const{fieldMeta:s}=this.state,i=this.resetFieldMeta(s);t&&!(null==e?void 0:e.keepDefaultValues)&&(this.options={...this.options,defaultValues:t}),this.baseStore.setState((()=>{var e;return k({...this.options.defaultState,values:t??this.options.defaultValues??(null==(e=this.options.defaultState)?void 0:e.values),fieldMetaBase:i})}))},this.validateAllFields=async t=>{const e=[];return q((()=>{Object.values(this.fieldInfo).forEach((s=>{if(!s.instance)return;const i=s.instance;e.push(Promise.resolve().then((()=>i.validate(t)))),s.instance.state.meta.isTouched||s.instance.setMeta((t=>({...t,isTouched:!0})))}))})),(await Promise.all(e)).flat()},this.validateArrayFieldsStartingFrom=async(t,e,s)=>{const i=this.getFieldValue(t),r=Array.isArray(i)?Math.max(i.length-1,0):null,n=[`${t}[${e}]`];for(let s=e+1;s<=(r??0);s++)n.push(`${t}[${s}]`);const a=Object.keys(this.fieldInfo).filter((t=>n.some((e=>t.startsWith(e))))),o=[];return q((()=>{a.forEach((t=>{o.push(Promise.resolve().then((()=>this.validateField(t,s))))}))})),(await Promise.all(o)).flat()},this.validateField=(t,e)=>{var s;const i=null==(s=this.fieldInfo[t])?void 0:s.instance;return i?(i.state.meta.isTouched||i.setMeta((t=>({...t,isTouched:!0}))),i.validate(e)):[]},this.validateSync=t=>{const e=M(t,this.options);let s=!1;const i={};q((()=>{for(const t of e){if(!t.validate)continue;const e=this.runValidator({validate:t.validate,value:{value:this.state.values,formApi:this,validationSource:"form"},type:"validate"}),{formError:r,fieldErrors:n}=L(e),a=B(t.cause);if(n)for(const[t,e]of Object.entries(n)){const s={...i[t]||{},[a]:e};i[t]=s;const r=this.getFieldMeta(t);r&&r.errorMap[a]!==e&&this.setFieldMeta(t,(t=>({...t,errorMap:{...t.errorMap,[a]:e}})))}this.state.errorMap[a]!==r&&this.baseStore.setState((t=>({...t,errorMap:{...t.errorMap,[a]:r}}))),(r||n)&&(s=!0)}}));const r=B("submit");return this.state.errorMap[r]&&"submit"!==t&&!s&&this.baseStore.setState((t=>({...t,errorMap:{...t.errorMap,[r]:void 0}}))),{hasErrored:s,fieldsErrorMap:i}},this.validateAsync=async t=>{const e=S(t,this.options);this.state.isFormValidating||this.baseStore.setState((t=>({...t,isFormValidating:!0})));const s=[];let i;for(const t of e){if(!t.validate)continue;const e=B(t.cause),r=this.state.validationMetaMap[e];null==r||r.lastAbortController.abort();const n=new AbortController;this.state.validationMetaMap[e]={lastAbortController:n},s.push(new Promise((async e=>{let s;try{s=await new Promise(((e,s)=>{setTimeout((async()=>{if(n.signal.aborted)return e(void 0);try{e(await this.runValidator({validate:t.validate,value:{value:this.state.values,formApi:this,validationSource:"form",signal:n.signal},type:"validateAsync"}))}catch(t){s(t)}}),t.debounceMs)}))}catch(t){s=t}const{formError:r,fieldErrors:a}=L(s);a&&(i=i?{...i,...a}:a);const o=B(t.cause);if(i)for(const[t,e]of Object.entries(i)){const s=this.getFieldMeta(t);s&&s.errorMap[o]!==e&&this.setFieldMeta(t,(t=>({...t,errorMap:{...t.errorMap,[o]:e}})))}this.baseStore.setState((t=>({...t,errorMap:{...t.errorMap,[o]:r}}))),e(i?{fieldErrors:i,errorMapKey:o}:void 0)})))}let r=[];const n={};if(s.length){r=await Promise.all(s);for(const t of r)if(null==t?void 0:t.fieldErrors){const{errorMapKey:e}=t;for(const[s,i]of Object.entries(t.fieldErrors)){const t={...n[s]||{},[e]:i};n[s]=t}}}return this.baseStore.setState((t=>({...t,isFormValidating:!1}))),n},this.validate=t=>{const{hasErrored:e,fieldsErrorMap:s}=this.validateSync(t);return e&&!this.options.asyncAlways?s:this.validateAsync(t)},this.handleSubmit=async()=>{var t,e,s,i;if(this.baseStore.setState((t=>({...t,isSubmitted:!1,submissionAttempts:t.submissionAttempts+1}))),!this.state.canSubmit)return;this.baseStore.setState((t=>({...t,isSubmitting:!0})));const r=()=>{this.baseStore.setState((t=>({...t,isSubmitting:!1})))};if(await this.validateAllFields("submit"),!this.state.isValid)return r(),void(null==(e=(t=this.options).onSubmitInvalid)||e.call(t,{value:this.state.values,formApi:this}));q((()=>{Object.values(this.fieldInfo).forEach((t=>{var e,s,i;null==(i=null==(s=null==(e=t.instance)?void 0:e.options.listeners)?void 0:s.onSubmit)||i.call(s,{value:t.instance.state.value,fieldApi:t.instance})}))}));try{await(null==(i=(s=this.options).onSubmit)?void 0:i.call(s,{value:this.state.values,formApi:this})),q((()=>{this.baseStore.setState((t=>({...t,isSubmitted:!0}))),r()}))}catch(t){throw r(),t}},this.getFieldValue=t=>c(this.state.values,t),this.getFieldMeta=t=>this.state.fieldMeta[t],this.getFieldInfo=t=>{var e;return(e=this.fieldInfo)[t]||(e[t]={instance:null,validationMetaMap:{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0}})},this.setFieldMeta=(t,e)=>{this.baseStore.setState((s=>({...s,fieldMetaBase:{...s.fieldMetaBase,[t]:l(e,s.fieldMetaBase[t])}})))},this.resetFieldMeta=t=>Object.keys(t).reduce(((t,e)=>(t[e]={isValidating:!1,isTouched:!1,isBlurred:!1,isDirty:!1,isPristine:!0,errors:[],errorMap:{}},t)),{}),this.setFieldValue=(t,e,s)=>{const i=(null==s?void 0:s.dontUpdateMeta)??!1;q((()=>{i||this.setFieldMeta(t,(t=>({...t,isTouched:!0,isDirty:!0,errorMap:{...null==t?void 0:t.errorMap,onMount:void 0}}))),this.baseStore.setState((s=>({...s,values:h(s.values,t,e)})))}))},this.deleteField=t=>{this.baseStore.setState((e=>{const s={...e};return s.values=function(t,e){const s=g(e);return function t(e){if(!e)return;if(1===s.length){const t=s[0];if(Array.isArray(e)&&"number"==typeof t)return e.filter(((e,s)=>s!==t));const{[t]:i,...r}=e;return r}const i=s.shift();if("string"==typeof i&&"object"==typeof e)return{...e,[i]:t(e[i])};if("number"==typeof i&&Array.isArray(e)){if(i>=e.length)return e;const s=e.slice(0,i);return[...s.length?s:new Array(i),t(e[i]),...e.slice(i+1)]}throw new Error("It seems we have created an infinite loop in deleteBy. ")}(t)}(s.values,t),delete s.fieldMetaBase[t],s})),delete this.fieldInfo[t]},this.pushFieldValue=(t,e,s)=>{this.setFieldValue(t,(t=>[...Array.isArray(t)?t:[],e]),s),this.validateField(t,"change")},this.insertFieldValue=async(t,e,s,i)=>{this.setFieldValue(t,(t=>[...t.slice(0,e),s,...t.slice(e)]),i),await this.validateField(t,"change")},this.replaceFieldValue=async(t,e,s,i)=>{this.setFieldValue(t,(t=>t.map(((t,i)=>i===e?s:t))),i),await this.validateField(t,"change"),await this.validateArrayFieldsStartingFrom(t,e,"change")},this.removeFieldValue=async(t,e,s)=>{const i=this.getFieldValue(t),r=Array.isArray(i)?Math.max(i.length-1,0):null;if(this.setFieldValue(t,(t=>t.filter(((t,s)=>s!==e))),s),null!==r){const e=`${t}[${r}]`;Object.keys(this.fieldInfo).filter((t=>t.startsWith(e))).forEach((t=>this.deleteField(t)))}await this.validateField(t,"change"),await this.validateArrayFieldsStartingFrom(t,e,"change")},this.swapFieldValues=(t,e,s,i)=>{this.setFieldValue(t,(t=>{const i=t[e],r=t[s];return h(h(t,`${e}`,r),`${s}`,i)}),i),this.validateField(t,"change"),this.validateField(`${t}[${e}]`,"change"),this.validateField(`${t}[${s}]`,"change")},this.moveFieldValues=(t,e,s,i)=>{this.setFieldValue(t,(t=>(t.splice(s,0,t.splice(e,1)[0]),t)),i),this.validateField(t,"change"),this.validateField(`${t}[${e}]`,"change"),this.validateField(`${t}[${s}]`,"change")},this.baseStore=new w(k({...null==t?void 0:t.defaultState,values:(null==t?void 0:t.defaultValues)??(null==(e=null==t?void 0:t.defaultState)?void 0:e.values),isFormValid:!0})),this.fieldMetaDerived=new O({deps:[this.baseStore],fn:({prevDepVals:t,currDepVals:e,prevVal:s})=>{const i=s,r=null==t?void 0:t[0],n=e[0],a={};for(const t of Object.keys(n.fieldMetaBase)){const e=n.fieldMetaBase[t],s=null==r?void 0:r.fieldMetaBase[t],o=null==i?void 0:i[t];let u=null==o?void 0:o.errors;s&&e.errorMap===s.errorMap||(u=Object.values(e.errorMap??{}).filter((t=>void 0!==t)));const l=!e.isDirty;o&&o.isPristine===l&&o.errors===u&&e===s?a[t]=o:a[t]={...e,errors:u,isPristine:l}}return a}}),this.store=new O({deps:[this.baseStore,this.fieldMetaDerived],fn:({prevDepVals:t,currDepVals:e,prevVal:s})=>{var i,r,n,a;const o=s,u=null==t?void 0:t[0],l=e[0],c=Object.values(l.fieldMetaBase),h=c.some((t=>null==t?void 0:t.isValidating)),d=!c.some((t=>{return(null==t?void 0:t.errorMap)&&(e=Object.values(t.errorMap).filter(Boolean),!(Array.isArray(e)&&0===e.length));var e})),f=c.some((t=>null==t?void 0:t.isTouched)),p=c.some((t=>null==t?void 0:t.isBlurred)),v=f&&(null==(i=null==l?void 0:l.errorMap)?void 0:i.onMount),y=c.some((t=>null==t?void 0:t.isDirty)),m=!y,b=Boolean((null==(r=l.errorMap)?void 0:r.onMount)||c.some((t=>{var e;return null==(e=null==t?void 0:t.errorMap)?void 0:e.onMount}))),g=!!h;let S=(null==o?void 0:o.errors)??[];u&&l.errorMap===u.errorMap||(S=Object.values(l.errorMap).reduce(((t,e)=>void 0===e?t:"string"==typeof e?(t.push(e),t):e&&"object"==typeof e?(t.push(e.form),t):t),[]));const M=0===S.length,w=d&&M,O=0===l.submissionAttempts&&!f&&!b||!g&&!l.isSubmitting&&w;let R=l.errorMap;v&&(S=S.filter((t=>t!==l.errorMap.onMount)),R=Object.assign(R,{onMount:void 0}));let F={...l,errorMap:R,fieldMeta:this.fieldMetaDerived.state,errors:S,isFieldsValidating:h,isFieldsValid:d,isFormValid:M,isValid:w,canSubmit:O,isTouched:f,isBlurred:p,isPristine:m,isDirty:y};const E=(null==(n=this.options.transform)?void 0:n.deps)??[];if(E.length!==this.prevTransformArray.length||E.some(((t,e)=>t!==this.prevTransformArray[e]))){const t=Object.assign({},this,{state:F});null==(a=this.options.transform)||a.fn(t),F=t.state,this.prevTransformArray=E}return F}}),this.update(t||{})}get state(){return this.store.state}runValidator(t){const e=this.options.validatorAdapter;return e&&("function"!=typeof t.validate||"~standard"in t.validate)?e()[t.type](t.value,t.validate):j(t.validate)?_()()[t.type](t.value,t.validate):t.validate(t.value)}setErrorMap(t){this.baseStore.setState((e=>({...e,errorMap:{...e.errorMap,...t}})))}}function L(t){return t?"object"==typeof t?{formError:L(t.form).formError,fieldErrors:t.fields}:"string"!=typeof t?{formError:"Invalid Form Values"}:{formError:t}:{formError:void 0}}function B(t){switch(t){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";default:return"onChange"}}var K=s(242);function G(t,e=t=>t){return(0,K.useSyncExternalStoreWithSelector)(t.subscribe,(()=>t.state),(()=>t.state),e,$)}function $(t,e){if(Object.is(t,e))return!0;if("object"!=typeof t||null===t||"object"!=typeof e||null===e)return!1;if(t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(const[s,i]of t)if(!e.has(s)||!Object.is(i,e.get(s)))return!1;return!0}if(t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(const s of t)if(!e.has(s))return!1;return!0}const s=Object.keys(t);if(s.length!==Object.keys(e).length)return!1;for(let i=0;i<s.length;i++)if(!Object.prototype.hasOwnProperty.call(e,s[i])||!Object.is(t[s[i]],e[s[i]]))return!1;return!0}class H{constructor(t){this.options={},this.mount=()=>{var t,e;const s=this.store.mount();this.getInfo().instance=this,this.update(this.options);const{onMount:i}=this.options.validators||{};if(i){const t=this.runValidator({validate:i,value:{value:this.state.value,fieldApi:this,validationSource:"field"},type:"validate"});t&&this.setMeta((e=>({...e,errorMap:{...null==e?void 0:e.errorMap,onMount:t}})))}return null==(e=null==(t=this.options.listeners)?void 0:t.onMount)||e.call(t,{value:this.state.value,fieldApi:this}),s},this.update=t=>{if(void 0===this.state.value){const e=c(t.form.options.defaultValues,t.name);void 0!==t.defaultValue?this.setValue(t.defaultValue,{dontUpdateMeta:!0}):void 0!==e&&this.setValue(e,{dontUpdateMeta:!0})}void 0===this.form.getFieldMeta(this.name)&&this.setMeta(this.state.meta),this.options=t,this.name=t.name},this.getValue=()=>this.form.getFieldValue(this.name),this.setValue=(t,e)=>{var s,i;this.form.setFieldValue(this.name,t,e),null==(i=null==(s=this.options.listeners)?void 0:s.onChange)||i.call(s,{value:this.state.value,fieldApi:this}),this.validate("change")},this.getMeta=()=>this.store.state.meta,this.setMeta=t=>this.form.setFieldMeta(this.name,t),this.getInfo=()=>this.form.getFieldInfo(this.name),this.pushValue=(t,e)=>this.form.pushFieldValue(this.name,t,e),this.insertValue=(t,e,s)=>this.form.insertFieldValue(this.name,t,e,s),this.replaceValue=(t,e,s)=>this.form.replaceFieldValue(this.name,t,e,s),this.removeValue=(t,e)=>this.form.removeFieldValue(this.name,t,e),this.swapValues=(t,e,s)=>this.form.swapFieldValues(this.name,t,e,s),this.moveValue=(t,e,s)=>this.form.moveFieldValues(this.name,t,e,s),this.getLinkedFields=t=>{const e=Object.values(this.form.fieldInfo),s=[];for(const i of e){if(!i.instance)continue;const{onChangeListenTo:e,onBlurListenTo:r}=i.instance.options.validators||{};"change"===t&&(null==e?void 0:e.includes(this.name))&&s.push(i.instance),"blur"===t&&(null==r?void 0:r.includes(this.name))&&s.push(i.instance)}return s},this.validateSync=(t,e)=>{const s=M(t,this.options),i=this.getLinkedFields(t).reduce(((e,s)=>{const i=M(t,s.options);return i.forEach((t=>{t.field=s})),e.concat(i)}),[]);let r=!1;q((()=>{const t=(t,s)=>{const i=W(s.cause),n=s.validate?N(t.runValidator({validate:s.validate,value:{value:t.store.state.value,validationSource:"field",fieldApi:t},type:"validate"})):e[i];t.state.meta.errorMap[i]!==n&&t.setMeta((t=>({...t,errorMap:{...t.errorMap,[W(s.cause)]:n||e[i]}}))),(n||e[i])&&(r=!0)};for(const e of s)t(this,e);for(const e of i)e.validate&&t(e.field,e)}));const n=W("submit");return this.state.meta.errorMap[n]&&"submit"!==t&&!r&&this.setMeta((t=>({...t,errorMap:{...t.errorMap,[n]:void 0}}))),{hasErrored:r}},this.validateAsync=async(t,e)=>{const s=S(t,this.options),i=await e,r=this.getLinkedFields(t),n=r.reduce(((e,s)=>{const i=S(t,s.options);return i.forEach((t=>{t.field=s})),e.concat(i)}),[]);this.state.meta.isValidating||this.setMeta((t=>({...t,isValidating:!0})));for(const t of r)t.setMeta((t=>({...t,isValidating:!0})));const a=[],o=[],u=(t,e,s)=>{const r=W(e.cause),n=t.getInfo().validationMetaMap[r];null==n||n.lastAbortController.abort();const a=new AbortController;this.getInfo().validationMetaMap[r]={lastAbortController:a},s.push(new Promise((async s=>{var n;let o;try{o=await new Promise(((s,i)=>{this.timeoutIds[e.cause]&&clearTimeout(this.timeoutIds[e.cause]),this.timeoutIds[e.cause]=setTimeout((async()=>{if(a.signal.aborted)return s(void 0);try{s(await this.runValidator({validate:e.validate,value:{value:t.store.state.value,fieldApi:t,signal:a.signal,validationSource:"field"},type:"validateAsync"}))}catch(t){i(t)}}),e.debounceMs)}))}catch(t){o=t}if(a.signal.aborted)return s(void 0);const u=N(o),l=null==(n=i[this.name])?void 0:n[r],c=u||l;t.setMeta((t=>({...t,errorMap:{...null==t?void 0:t.errorMap,[r]:c}}))),s(c)})))};for(const t of s)t.validate&&u(this,t,a);for(const t of n)t.validate&&u(t.field,t,o);let l=[];(a.length||o.length)&&(l=await Promise.all(a),await Promise.all(o)),this.setMeta((t=>({...t,isValidating:!1})));for(const t of r)t.setMeta((t=>({...t,isValidating:!1})));return l.filter(Boolean)},this.validate=t=>{var e;if(!this.state.meta.isTouched)return[];const{fieldsErrorMap:s}=this.form.validateSync(t),{hasErrored:i}=this.validateSync(t,s[this.name]??{});if(i&&!this.options.asyncAlways)return null==(e=this.getInfo().validationMetaMap[W(t)])||e.lastAbortController.abort(),this.state.meta.errors;const r=this.form.validateAsync(t);return this.validateAsync(t,r)},this.handleChange=t=>{this.setValue(t)},this.handleBlur=()=>{var t,e;this.state.meta.isTouched||(this.setMeta((t=>({...t,isTouched:!0}))),this.validate("change")),this.state.meta.isBlurred||this.setMeta((t=>({...t,isBlurred:!0}))),this.validate("blur"),null==(e=null==(t=this.options.listeners)?void 0:t.onBlur)||e.call(t,{value:this.state.value,fieldApi:this})},this.form=t.form,this.name=t.name,this.timeoutIds={},void 0!==t.defaultValue&&this.form.setFieldValue(this.name,t.defaultValue,{dontUpdateMeta:!0}),this.store=new O({deps:[this.form.store],fn:()=>({value:this.form.getFieldValue(this.name),meta:this.form.getFieldMeta(this.name)??{isValidating:!1,isTouched:!1,isBlurred:!1,isDirty:!1,isPristine:!0,errors:[],errorMap:{},...t.defaultMeta}})}),this.options=t}get state(){return this.store.state}runValidator(t){const e=[this.form.options.validatorAdapter,this.options.validatorAdapter];for(const s of e)if(s&&("function"!=typeof t.validate||"~standard"in t.validate))return s()[t.type](t.value,t.validate);return j(t.validate)?_()()[t.type](t.value,t.validate):t.validate(t.value)}setErrorMap(t){this.setMeta((e=>({...e,errorMap:{...e.errorMap,...t}})))}}function N(t){if(t)return"string"!=typeof t?"Invalid Form Values":t}function W(t){switch(t){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";default:return"onChange"}}const z="undefined"!=typeof window?i.useLayoutEffect:i.useEffect,X=({children:t,...e})=>{const s=function(t){const[e]=(0,i.useState)((()=>{const e=new H({...t,form:t.form,name:t.name});return e.Field=X,e}));return z(e.mount,[e]),z((()=>{e.update(t)})),G(e.store,"array"===t.mode?t=>[t.meta,Object.keys(t.value??[]).length]:void 0),e}(e),r=(0,i.useMemo)((()=>l(t,s)),[t,s,s.state.value,s.state.meta]);return(0,u.jsx)(u.Fragment,{children:r})};function Z({form:t,selector:e,children:s}){return l(s,G(t.store,e))}var J=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Y="undefined"==typeof window||"Deno"in globalThis;function tt(){}function et(t){return"number"==typeof t&&t>=0&&t!==1/0}function st(t,e){return Math.max(t+(e||0)-Date.now(),0)}function it(t,e){return"function"==typeof t?t(e):t}function rt(t,e){return"function"==typeof t?t(e):t}function nt(t,e){const{type:s="all",exact:i,fetchStatus:r,predicate:n,queryKey:a,stale:o}=t;if(a)if(i){if(e.queryHash!==ot(a,e.options))return!1}else if(!lt(e.queryKey,a))return!1;if("all"!==s){const t=e.isActive();if("active"===s&&!t)return!1;if("inactive"===s&&t)return!1}return!("boolean"==typeof o&&e.isStale()!==o||r&&r!==e.state.fetchStatus||n&&!n(e))}function at(t,e){const{exact:s,status:i,predicate:r,mutationKey:n}=t;if(n){if(!e.options.mutationKey)return!1;if(s){if(ut(e.options.mutationKey)!==ut(n))return!1}else if(!lt(e.options.mutationKey,n))return!1}return!(i&&e.state.status!==i||r&&!r(e))}function ot(t,e){return(e?.queryKeyHashFn||ut)(t)}function ut(t){return JSON.stringify(t,((t,e)=>ft(e)?Object.keys(e).sort().reduce(((t,s)=>(t[s]=e[s],t)),{}):e))}function lt(t,e){return t===e||typeof t==typeof e&&!(!t||!e||"object"!=typeof t||"object"!=typeof e)&&!Object.keys(e).some((s=>!lt(t[s],e[s])))}function ct(t,e){if(t===e)return t;const s=dt(t)&&dt(e);if(s||ft(t)&&ft(e)){const i=s?t:Object.keys(t),r=i.length,n=s?e:Object.keys(e),a=n.length,o=s?[]:{};let u=0;for(let r=0;r<a;r++){const a=s?r:n[r];(!s&&i.includes(a)||s)&&void 0===t[a]&&void 0===e[a]?(o[a]=void 0,u++):(o[a]=ct(t[a],e[a]),o[a]===t[a]&&void 0!==t[a]&&u++)}return r===a&&u===r?t:o}return e}function ht(t,e){if(!e||Object.keys(t).length!==Object.keys(e).length)return!1;for(const s in t)if(t[s]!==e[s])return!1;return!0}function dt(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function ft(t){if(!pt(t))return!1;const e=t.constructor;if(void 0===e)return!0;const s=e.prototype;return!!pt(s)&&!!s.hasOwnProperty("isPrototypeOf")&&Object.getPrototypeOf(t)===Object.prototype}function pt(t){return"[object Object]"===Object.prototype.toString.call(t)}function vt(t,e,s){return"function"==typeof s.structuralSharing?s.structuralSharing(t,e):!1!==s.structuralSharing?ct(t,e):e}function yt(t,e,s=0){const i=[...t,e];return s&&i.length>s?i.slice(1):i}function mt(t,e,s=0){const i=[e,...t];return s&&i.length>s?i.slice(0,-1):i}var bt=Symbol();function gt(t,e){return!t.queryFn&&e?.initialPromise?()=>e.initialPromise:t.queryFn&&t.queryFn!==bt?t.queryFn:()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`))}var St=new class extends J{#t;#e;#s;constructor(){super(),this.#s=t=>{if(!Y&&window.addEventListener){const e=()=>t();return window.addEventListener("visibilitychange",e,!1),()=>{window.removeEventListener("visibilitychange",e)}}}}onSubscribe(){this.#e||this.setEventListener(this.#s)}onUnsubscribe(){this.hasListeners()||(this.#e?.(),this.#e=void 0)}setEventListener(t){this.#s=t,this.#e?.(),this.#e=t((t=>{"boolean"==typeof t?this.setFocused(t):this.onFocus()}))}setFocused(t){this.#t!==t&&(this.#t=t,this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach((e=>{e(t)}))}isFocused(){return"boolean"==typeof this.#t?this.#t:"hidden"!==globalThis.document?.visibilityState}},Mt=function(){let t=[],e=0,s=t=>{t()},i=t=>{t()},r=t=>setTimeout(t,0);const n=i=>{e?t.push(i):r((()=>{s(i)}))};return{batch:n=>{let a;e++;try{a=n()}finally{e--,e||(()=>{const e=t;t=[],e.length&&r((()=>{i((()=>{e.forEach((t=>{s(t)}))}))}))})()}return a},batchCalls:t=>(...e)=>{n((()=>{t(...e)}))},schedule:n,setNotifyFunction:t=>{s=t},setBatchNotifyFunction:t=>{i=t},setScheduler:t=>{r=t}}}(),wt=new class extends J{#i=!0;#e;#s;constructor(){super(),this.#s=t=>{if(!Y&&window.addEventListener){const e=()=>t(!0),s=()=>t(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",s,!1),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",s)}}}}onSubscribe(){this.#e||this.setEventListener(this.#s)}onUnsubscribe(){this.hasListeners()||(this.#e?.(),this.#e=void 0)}setEventListener(t){this.#s=t,this.#e?.(),this.#e=t(this.setOnline.bind(this))}setOnline(t){this.#i!==t&&(this.#i=t,this.listeners.forEach((e=>{e(t)})))}isOnline(){return this.#i}};function Ot(){let t,e;const s=new Promise(((s,i)=>{t=s,e=i}));function i(t){Object.assign(s,t),delete s.resolve,delete s.reject}return s.status="pending",s.catch((()=>{})),s.resolve=e=>{i({status:"fulfilled",value:e}),t(e)},s.reject=t=>{i({status:"rejected",reason:t}),e(t)},s}function Rt(t){return Math.min(1e3*2**t,3e4)}function Ft(t){return"online"!==(t??"online")||wt.isOnline()}var Et=class extends Error{constructor(t){super("CancelledError"),this.revert=t?.revert,this.silent=t?.silent}};function Ct(t){return t instanceof Et}function At(t){let e,s=!1,i=0,r=!1;const n=Ot(),a=()=>St.isFocused()&&("always"===t.networkMode||wt.isOnline())&&t.canRun(),o=()=>Ft(t.networkMode)&&t.canRun(),u=s=>{r||(r=!0,t.onSuccess?.(s),e?.(),n.resolve(s))},l=s=>{r||(r=!0,t.onError?.(s),e?.(),n.reject(s))},c=()=>new Promise((s=>{e=t=>{(r||a())&&s(t)},t.onPause?.()})).then((()=>{e=void 0,r||t.onContinue?.()})),h=()=>{if(r)return;let e;const n=0===i?t.initialPromise:void 0;try{e=n??t.fn()}catch(t){e=Promise.reject(t)}Promise.resolve(e).then(u).catch((e=>{if(r)return;const n=t.retry??(Y?0:3),o=t.retryDelay??Rt,u="function"==typeof o?o(i,e):o,d=!0===n||"number"==typeof n&&i<n||"function"==typeof n&&n(i,e);var f;!s&&d?(i++,t.onFail?.(i,e),(f=u,new Promise((t=>{setTimeout(t,f)}))).then((()=>a()?void 0:c())).then((()=>{s?l(e):h()}))):l(e)}))};return{promise:n,cancel:e=>{r||(l(new Et(e)),t.abort?.())},continue:()=>(e?.(),n),cancelRetry:()=>{s=!0},continueRetry:()=>{s=!1},canStart:o,start:()=>(o()?h():c().then(h),n)}}var Vt=class{#r;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),et(this.gcTime)&&(this.#r=setTimeout((()=>{this.optionalRemove()}),this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(Y?1/0:3e5))}clearGcTimeout(){this.#r&&(clearTimeout(this.#r),this.#r=void 0)}},Pt=class extends Vt{#n;#a;#o;#u;#l;#c;constructor(t){super(),this.#c=!1,this.#l=t.defaultOptions,this.setOptions(t.options),this.observers=[],this.#o=t.cache,this.queryKey=t.queryKey,this.queryHash=t.queryHash,this.#n=function(t){const e="function"==typeof t.initialData?t.initialData():t.initialData,s=void 0!==e,i=s?"function"==typeof t.initialDataUpdatedAt?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:s?i??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:s?"success":"pending",fetchStatus:"idle"}}(this.options),this.state=t.state??this.#n,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#u?.promise}setOptions(t){this.options={...this.#l,...t},this.updateGcTime(this.options.gcTime)}optionalRemove(){this.observers.length||"idle"!==this.state.fetchStatus||this.#o.remove(this)}setData(t,e){const s=vt(this.state.data,t,this.options);return this.#h({data:s,type:"success",dataUpdatedAt:e?.updatedAt,manual:e?.manual}),s}setState(t,e){this.#h({type:"setState",state:t,setStateOptions:e})}cancel(t){const e=this.#u?.promise;return this.#u?.cancel(t),e?e.then(tt).catch(tt):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#n)}isActive(){return this.observers.some((t=>!1!==rt(t.options.enabled,this)))}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===bt||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStale(){return!!this.state.isInvalidated||(this.getObserversCount()>0?this.observers.some((t=>t.getCurrentResult().isStale)):void 0===this.state.data)}isStaleByTime(t=0){return this.state.isInvalidated||void 0===this.state.data||!st(this.state.dataUpdatedAt,t)}onFocus(){const t=this.observers.find((t=>t.shouldFetchOnWindowFocus()));t?.refetch({cancelRefetch:!1}),this.#u?.continue()}onOnline(){const t=this.observers.find((t=>t.shouldFetchOnReconnect()));t?.refetch({cancelRefetch:!1}),this.#u?.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),this.#o.notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter((e=>e!==t)),this.observers.length||(this.#u&&(this.#c?this.#u.cancel({revert:!0}):this.#u.cancelRetry()),this.scheduleGc()),this.#o.notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#h({type:"invalidate"})}fetch(t,e){if("idle"!==this.state.fetchStatus)if(void 0!==this.state.data&&e?.cancelRefetch)this.cancel({silent:!0});else if(this.#u)return this.#u.continueRetry(),this.#u.promise;if(t&&this.setOptions(t),!this.options.queryFn){const t=this.observers.find((t=>t.options.queryFn));t&&this.setOptions(t.options)}const s=new AbortController,i=t=>{Object.defineProperty(t,"signal",{enumerable:!0,get:()=>(this.#c=!0,s.signal)})},r={fetchOptions:e,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:()=>{const t=gt(this.options,e),s={queryKey:this.queryKey,meta:this.meta};return i(s),this.#c=!1,this.options.persister?this.options.persister(t,s,this):t(s)}};i(r),this.options.behavior?.onFetch(r,this),this.#a=this.state,"idle"!==this.state.fetchStatus&&this.state.fetchMeta===r.fetchOptions?.meta||this.#h({type:"fetch",meta:r.fetchOptions?.meta});const n=t=>{Ct(t)&&t.silent||this.#h({type:"error",error:t}),Ct(t)||(this.#o.config.onError?.(t,this),this.#o.config.onSettled?.(this.state.data,t,this)),this.scheduleGc()};return this.#u=At({initialPromise:e?.initialPromise,fn:r.fetchFn,abort:s.abort.bind(s),onSuccess:t=>{if(void 0!==t){try{this.setData(t)}catch(t){return void n(t)}this.#o.config.onSuccess?.(t,this),this.#o.config.onSettled?.(t,this.state.error,this),this.scheduleGc()}else n(new Error(`${this.queryHash} data is undefined`))},onError:n,onFail:(t,e)=>{this.#h({type:"failed",failureCount:t,error:e})},onPause:()=>{this.#h({type:"pause"})},onContinue:()=>{this.#h({type:"continue"})},retry:r.options.retry,retryDelay:r.options.retryDelay,networkMode:r.options.networkMode,canRun:()=>!0}),this.#u.start()}#h(t){this.state=(e=>{switch(t.type){case"failed":return{...e,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...e,fetchStatus:"paused"};case"continue":return{...e,fetchStatus:"fetching"};case"fetch":return{...e,...Dt(e.data,this.options),fetchMeta:t.meta??null};case"success":return{...e,data:t.data,dataUpdateCount:e.dataUpdateCount+1,dataUpdatedAt:t.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const s=t.error;return Ct(s)&&s.revert&&this.#a?{...this.#a,fetchStatus:"idle"}:{...e,error:s,errorUpdateCount:e.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:e.fetchFailureCount+1,fetchFailureReason:s,fetchStatus:"idle",status:"error"};case"invalidate":return{...e,isInvalidated:!0};case"setState":return{...e,...t.state}}})(this.state),Mt.batch((()=>{this.observers.forEach((t=>{t.onQueryUpdate()})),this.#o.notify({query:this,type:"updated",action:t})}))}};function Dt(t,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:Ft(e.networkMode)?"fetching":"paused",...void 0===t&&{error:null,status:"pending"}}}var It=class extends J{constructor(t,e){super(),this.options=e,this.#d=t,this.#f=null,this.#p=Ot(),this.options.experimental_prefetchInRender||this.#p.reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(e)}#d;#v=void 0;#y=void 0;#m=void 0;#b;#g;#p;#f;#S;#M;#w;#O;#R;#F;#E=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){1===this.listeners.size&&(this.#v.addObserver(this),xt(this.#v,this.options)?this.#C():this.updateResult(),this.#A())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return Tt(this.#v,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return Tt(this.#v,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#V(),this.#P(),this.#v.removeObserver(this)}setOptions(t,e){const s=this.options,i=this.#v;if(this.options=this.#d.defaultQueryOptions(t),void 0!==this.options.enabled&&"boolean"!=typeof this.options.enabled&&"function"!=typeof this.options.enabled&&"boolean"!=typeof rt(this.options.enabled,this.#v))throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#D(),this.#v.setOptions(this.options),s._defaulted&&!ht(this.options,s)&&this.#d.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#v,observer:this});const r=this.hasListeners();r&&qt(this.#v,i,this.options,s)&&this.#C(),this.updateResult(e),!r||this.#v===i&&rt(this.options.enabled,this.#v)===rt(s.enabled,this.#v)&&it(this.options.staleTime,this.#v)===it(s.staleTime,this.#v)||this.#I();const n=this.#x();!r||this.#v===i&&rt(this.options.enabled,this.#v)===rt(s.enabled,this.#v)&&n===this.#F||this.#T(n)}getOptimisticResult(t){const e=this.#d.getQueryCache().build(this.#d,t),s=this.createResult(e,t);return i=s,!ht(this.getCurrentResult(),i)&&(this.#m=s,this.#g=this.options,this.#b=this.#v.state),s;var i}getCurrentResult(){return this.#m}trackResult(t,e){const s={};return Object.keys(t).forEach((i=>{Object.defineProperty(s,i,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(i),e?.(i),t[i])})})),s}trackProp(t){this.#E.add(t)}getCurrentQuery(){return this.#v}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const e=this.#d.defaultQueryOptions(t),s=this.#d.getQueryCache().build(this.#d,e);return s.fetch().then((()=>this.createResult(s,e)))}fetch(t){return this.#C({...t,cancelRefetch:t.cancelRefetch??!0}).then((()=>(this.updateResult(),this.#m)))}#C(t){this.#D();let e=this.#v.fetch(this.options,t);return t?.throwOnError||(e=e.catch(tt)),e}#I(){this.#V();const t=it(this.options.staleTime,this.#v);if(Y||this.#m.isStale||!et(t))return;const e=st(this.#m.dataUpdatedAt,t)+1;this.#O=setTimeout((()=>{this.#m.isStale||this.updateResult()}),e)}#x(){return("function"==typeof this.options.refetchInterval?this.options.refetchInterval(this.#v):this.options.refetchInterval)??!1}#T(t){this.#P(),this.#F=t,!Y&&!1!==rt(this.options.enabled,this.#v)&&et(this.#F)&&0!==this.#F&&(this.#R=setInterval((()=>{(this.options.refetchIntervalInBackground||St.isFocused())&&this.#C()}),this.#F))}#A(){this.#I(),this.#T(this.#x())}#V(){this.#O&&(clearTimeout(this.#O),this.#O=void 0)}#P(){this.#R&&(clearInterval(this.#R),this.#R=void 0)}createResult(t,e){const s=this.#v,i=this.options,r=this.#m,n=this.#b,a=this.#g,o=t!==s?t.state:this.#y,{state:u}=t;let l,c={...u},h=!1;if(e._optimisticResults){const r=this.hasListeners(),n=!r&&xt(t,e),a=r&&qt(t,s,e,i);(n||a)&&(c={...c,...Dt(u.data,t.options)}),"isRestoring"===e._optimisticResults&&(c.fetchStatus="idle")}let{error:d,errorUpdatedAt:f,status:p}=c;if(e.select&&void 0!==c.data)if(r&&c.data===n?.data&&e.select===this.#S)l=this.#M;else try{this.#S=e.select,l=e.select(c.data),l=vt(r?.data,l,e),this.#M=l,this.#f=null}catch(t){this.#f=t}else l=c.data;if(void 0!==e.placeholderData&&void 0===l&&"pending"===p){let t;if(r?.isPlaceholderData&&e.placeholderData===a?.placeholderData)t=r.data;else if(t="function"==typeof e.placeholderData?e.placeholderData(this.#w?.state.data,this.#w):e.placeholderData,e.select&&void 0!==t)try{t=e.select(t),this.#f=null}catch(t){this.#f=t}void 0!==t&&(p="success",l=vt(r?.data,t,e),h=!0)}this.#f&&(d=this.#f,l=this.#M,f=Date.now(),p="error");const v="fetching"===c.fetchStatus,y="pending"===p,m="error"===p,b=y&&v,g=void 0!==l,S={status:p,fetchStatus:c.fetchStatus,isPending:y,isSuccess:"success"===p,isError:m,isInitialLoading:b,isLoading:b,data:l,dataUpdatedAt:c.dataUpdatedAt,error:d,errorUpdatedAt:f,failureCount:c.fetchFailureCount,failureReason:c.fetchFailureReason,errorUpdateCount:c.errorUpdateCount,isFetched:c.dataUpdateCount>0||c.errorUpdateCount>0,isFetchedAfterMount:c.dataUpdateCount>o.dataUpdateCount||c.errorUpdateCount>o.errorUpdateCount,isFetching:v,isRefetching:v&&!y,isLoadingError:m&&!g,isPaused:"paused"===c.fetchStatus,isPlaceholderData:h,isRefetchError:m&&g,isStale:Qt(t,e),refetch:this.refetch,promise:this.#p};if(this.options.experimental_prefetchInRender){const e=t=>{"error"===S.status?t.reject(S.error):void 0!==S.data&&t.resolve(S.data)},i=()=>{const t=this.#p=S.promise=Ot();e(t)},r=this.#p;switch(r.status){case"pending":t.queryHash===s.queryHash&&e(r);break;case"fulfilled":"error"!==S.status&&S.data===r.value||i();break;case"rejected":"error"===S.status&&S.error===r.reason||i()}}return S}updateResult(t){const e=this.#m,s=this.createResult(this.#v,this.options);if(this.#b=this.#v.state,this.#g=this.options,void 0!==this.#b.data&&(this.#w=this.#v),ht(s,e))return;this.#m=s;const i={};!1!==t?.listeners&&(()=>{if(!e)return!0;const{notifyOnChangeProps:t}=this.options,s="function"==typeof t?t():t;if("all"===s||!s&&!this.#E.size)return!0;const i=new Set(s??this.#E);return this.options.throwOnError&&i.add("error"),Object.keys(this.#m).some((t=>{const s=t;return this.#m[s]!==e[s]&&i.has(s)}))})()&&(i.listeners=!0),this.#q({...i,...t})}#D(){const t=this.#d.getQueryCache().build(this.#d,this.options);if(t===this.#v)return;const e=this.#v;this.#v=t,this.#y=t.state,this.hasListeners()&&(e?.removeObserver(this),t.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#A()}#q(t){Mt.batch((()=>{t.listeners&&this.listeners.forEach((t=>{t(this.#m)})),this.#d.getQueryCache().notify({query:this.#v,type:"observerResultsUpdated"})}))}};function xt(t,e){return function(t,e){return!1!==rt(e.enabled,t)&&void 0===t.state.data&&!("error"===t.state.status&&!1===e.retryOnMount)}(t,e)||void 0!==t.state.data&&Tt(t,e,e.refetchOnMount)}function Tt(t,e,s){if(!1!==rt(e.enabled,t)){const i="function"==typeof s?s(t):s;return"always"===i||!1!==i&&Qt(t,e)}return!1}function qt(t,e,s,i){return(t!==e||!1===rt(i.enabled,t))&&(!s.suspense||"error"!==t.state.status)&&Qt(t,s)}function Qt(t,e){return!1!==rt(e.enabled,t)&&t.isStaleByTime(it(e.staleTime,t))}var _t=i.createContext(void 0),jt=t=>{const e=i.useContext(_t);if(t)return t;if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},kt=({client:t,children:e})=>(i.useEffect((()=>(t.mount(),()=>{t.unmount()})),[t]),(0,u.jsx)(_t.Provider,{value:t,children:e}));var Ut=i.createContext(function(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}());function Lt(t,e){return"function"==typeof t?t(...e):!!t}function Bt(){}var Kt=i.createContext(!1),Gt=(Kt.Provider,(t,e,s)=>e.fetchOptimistic(t).catch((()=>{s.clearReset()})));const $t=window.wp.apiFetch;var Ht=s.n($t);const Nt=()=>{const t=function(t,e,s){const r=jt(s),n=i.useContext(Kt),a=i.useContext(Ut),o=r.defaultQueryOptions(t);r.getDefaultOptions().queries?._experimental_beforeQuery?.(o),o._optimisticResults=n?"isRestoring":"optimistic",(t=>{const e=t.staleTime;t.suspense&&(t.staleTime="function"==typeof e?(...t)=>Math.max(e(...t),1e3):Math.max(e??1e3,1e3),"number"==typeof t.gcTime&&(t.gcTime=Math.max(t.gcTime,1e3)))})(o),((t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))})(o,a),(t=>{i.useEffect((()=>{t.clearReset()}),[t])})(a);const u=!r.getQueryCache().get(o.queryHash),[l]=i.useState((()=>new e(r,o))),c=l.getOptimisticResult(o),h=!n&&!1!==t.subscribed;if(i.useSyncExternalStore(i.useCallback((t=>{const e=h?l.subscribe(Mt.batchCalls(t)):Bt;return l.updateResult(),e}),[l,h]),(()=>l.getCurrentResult()),(()=>l.getCurrentResult())),i.useEffect((()=>{l.setOptions(o,{listeners:!1})}),[o,l]),((t,e)=>t?.suspense&&e.isPending)(o,c))throw Gt(o,l,a);if((({result:t,errorResetBoundary:e,throwOnError:s,query:i})=>t.isError&&!e.isReset()&&!t.isFetching&&i&&Lt(s,[t.error,i]))({result:c,errorResetBoundary:a,throwOnError:o.throwOnError,query:r.getQueryCache().get(o.queryHash)}))throw c.error;if(r.getDefaultOptions().queries?._experimental_afterQuery?.(o,c),o.experimental_prefetchInRender&&!Y&&((t,e)=>t.isLoading&&t.isFetching&&!e)(c,n)){const t=u?Gt(o,l,a):r.getQueryCache().get(o.queryHash)?.promise;t?.catch(Bt).finally((()=>{l.updateResult()}))}return o.notifyOnChangeProps?c:l.trackResult(c)}({queryKey:["settings-query"],retry:1,queryFn:async()=>await Ht()({path:"/modula-ai-image-descriptor/v1/ai-settings",method:"GET"})},It,void 0);return t},Wt=window.wp.primitives,zt=(0,u.jsx)(Wt.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,u.jsx)(Wt.Path,{d:"M16.7 7.1l-6.3 8.5-3.3-2.5-.9 1.2 4.5 3.4L17.9 8z"})}),Xt=(0,u.jsx)(Wt.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,u.jsx)(Wt.Path,{d:"m13.06 12 6.47-6.47-1.06-1.06L12 10.94 5.53 4.47 4.47 5.53 10.94 12l-6.47 6.47 1.06 1.06L12 13.06l6.47 6.47 1.06-1.06L13.06 12Z"})});var Zt=class extends Vt{#Q;#_;#u;constructor(t){super(),this.mutationId=t.mutationId,this.#_=t.mutationCache,this.#Q=[],this.state=t.state||{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0},this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){this.#Q.includes(t)||(this.#Q.push(t),this.clearGcTimeout(),this.#_.notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){this.#Q=this.#Q.filter((e=>e!==t)),this.scheduleGc(),this.#_.notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){this.#Q.length||("pending"===this.state.status?this.scheduleGc():this.#_.remove(this))}continue(){return this.#u?.continue()??this.execute(this.state.variables)}async execute(t){this.#u=At({fn:()=>this.options.mutationFn?this.options.mutationFn(t):Promise.reject(new Error("No mutationFn found")),onFail:(t,e)=>{this.#h({type:"failed",failureCount:t,error:e})},onPause:()=>{this.#h({type:"pause"})},onContinue:()=>{this.#h({type:"continue"})},retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#_.canRun(this)});const e="pending"===this.state.status,s=!this.#u.canStart();try{if(!e){this.#h({type:"pending",variables:t,isPaused:s}),await(this.#_.config.onMutate?.(t,this));const e=await(this.options.onMutate?.(t));e!==this.state.context&&this.#h({type:"pending",context:e,variables:t,isPaused:s})}const i=await this.#u.start();return await(this.#_.config.onSuccess?.(i,t,this.state.context,this)),await(this.options.onSuccess?.(i,t,this.state.context)),await(this.#_.config.onSettled?.(i,null,this.state.variables,this.state.context,this)),await(this.options.onSettled?.(i,null,t,this.state.context)),this.#h({type:"success",data:i}),i}catch(e){try{throw await(this.#_.config.onError?.(e,t,this.state.context,this)),await(this.options.onError?.(e,t,this.state.context)),await(this.#_.config.onSettled?.(void 0,e,this.state.variables,this.state.context,this)),await(this.options.onSettled?.(void 0,e,t,this.state.context)),e}finally{this.#h({type:"error",error:e})}}finally{this.#_.runNext(this)}}#h(t){this.state=(e=>{switch(t.type){case"failed":return{...e,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...e,isPaused:!0};case"continue":return{...e,isPaused:!1};case"pending":return{...e,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...e,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...e,data:void 0,error:t.error,failureCount:e.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}})(this.state),Mt.batch((()=>{this.#Q.forEach((e=>{e.onMutationUpdate(t)})),this.#_.notify({mutation:this,type:"updated",action:t})}))}},Jt=class extends J{#d;#m=void 0;#j;#k;constructor(t,e){super(),this.#d=t,this.setOptions(e),this.bindMethods(),this.#U()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){const e=this.options;this.options=this.#d.defaultMutationOptions(t),ht(this.options,e)||this.#d.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#j,observer:this}),e?.mutationKey&&this.options.mutationKey&&ut(e.mutationKey)!==ut(this.options.mutationKey)?this.reset():"pending"===this.#j?.state.status&&this.#j.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#j?.removeObserver(this)}onMutationUpdate(t){this.#U(),this.#q(t)}getCurrentResult(){return this.#m}reset(){this.#j?.removeObserver(this),this.#j=void 0,this.#U(),this.#q()}mutate(t,e){return this.#k=e,this.#j?.removeObserver(this),this.#j=this.#d.getMutationCache().build(this.#d,this.options),this.#j.addObserver(this),this.#j.execute(t)}#U(){const t=this.#j?.state??{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0};this.#m={...t,isPending:"pending"===t.status,isSuccess:"success"===t.status,isError:"error"===t.status,isIdle:"idle"===t.status,mutate:this.mutate,reset:this.reset}}#q(t){Mt.batch((()=>{if(this.#k&&this.hasListeners()){const e=this.#m.variables,s=this.#m.context;"success"===t?.type?(this.#k.onSuccess?.(t.data,e,s),this.#k.onSettled?.(t.data,null,e,s)):"error"===t?.type&&(this.#k.onError?.(t.error,e,s),this.#k.onSettled?.(void 0,t.error,e,s))}this.listeners.forEach((t=>{t(this.#m)}))}))}};function Yt(){const[t,e]=(0,r.useState)(!1),[s,l]=(0,r.useState)(!1),{mutate:c}=(({onSuccess:t}={})=>{const e=jt();return function(t){const e=jt(void 0),[s]=i.useState((()=>new Jt(e,t)));i.useEffect((()=>{s.setOptions(t)}),[s,t]);const r=i.useSyncExternalStore(i.useCallback((t=>s.subscribe(Mt.batchCalls(t))),[s]),(()=>s.getCurrentResult()),(()=>s.getCurrentResult())),n=i.useCallback(((t,e)=>{s.mutate(t,e).catch(Bt)}),[s]);if(r.error&&Lt(s.options.throwOnError,[r.error]))throw r.error;return{...r,mutate:n,mutateAsync:r.mutate}}({mutationFn:(0,r.useCallback)((t=>Ht()({path:"/modula-ai-image-descriptor/v1/ai-settings",method:"POST",data:{api_key:t.api_key}})),[]),onSuccess:(s,i,r)=>{e.invalidateQueries({refetchType:"all",queryKey:["settings-query"]}),t&&t(s,i,r)}})})(),{data:h}=Nt(),d=function(t){const[e]=(0,i.useState)((()=>{const e=new U(t),s=e;return s.Field=function(t){return(0,u.jsx)(X,{...t,form:e})},s.Subscribe=t=>(0,u.jsx)(Z,{form:e,selector:t.selector,children:t.children}),s}));return z(e.mount,[]),G(e.store,(t=>t.isSubmitting)),z((()=>{e.update(t)})),e}({defaultValues:{apiKey:h?.api_key,email:h?.readonly?.email,first_name:h?.readonly?.first_name,last_name:h?.readonly?.last_name,valid_key:h?.readonly?.valid_key},onSubmit:async({value:t})=>{e(!0),c({api_key:t.apiKey}),e(!1),l(!0)}}),f=h?.readonly?.valid_key;return React.createElement("div",{className:"ZrVV_oVUUXei2_m9bGmy"},!f&&React.createElement(React.Fragment,null,React.createElement("p",{className:o},(0,a.__)("In order to use this powerful functionality you will first need to claim your credits.","modula-best-grid-gallery")),React.createElement("p",{className:o},(0,a.__)('If you already have the api key, use it in the field below or click "Claim Credits" to get a new one.',"modula-best-grid-gallery"))),React.createElement("form",{onSubmit:t=>{t.preventDefault(),t.stopPropagation(),d.handleSubmit()}},React.createElement(d.Field,{name:"apiKey",children:t=>React.createElement(n.TextControl,{__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,label:React.createElement(n.Flex,{justify:"space-between"},React.createElement(n.FlexItem,null,React.createElement(n.Flex,{justify:"flex-start",gap:2},React.createElement(n.FlexItem,null,(0,a.__)("API Key","modula-best-grid-gallery")),React.createElement(n.FlexItem,null,React.createElement(n.Icon,{style:{fill:f?"green":"red"},size:f?18:14,icon:f?zt:Xt,className:"modula-settings-form-valid-key"})))),React.createElement(n.FlexItem,null,f&&React.createElement(React.Fragment,null,h?.readonly?.credits," ",(0,a.__)("Credits remaining","modula-best-grid-gallery")),!f&&React.createElement(React.Fragment,null,(0,a.__)("Invalid API Key","modula-best-grid-gallery")))),value:t.state.value,onChange:e=>{t.handleChange(e)}})}),React.createElement(n.__experimentalSpacer,{marginTop:4,marginBottom:4}),React.createElement(n.Flex,{justify:"flex-start",gap:4,className:"tcyly_pF221L4i3gxM3j"},React.createElement(d.Subscribe,{selector:t=>[t.canSubmit],children:([e])=>React.createElement(n.Button,{variant:"primary",type:"submit",iconPosition:"right",icon:t?React.createElement(n.Spinner,null):s?zt:null,isDisabled:!e},t?(0,a.__)(" saving","modula-best-grid-gallery"):s?(0,a.__)("Saved","modula-best-grid-gallery"):(0,a.__)("Save API Key","modula-best-grid-gallery"))}),!f&&React.createElement(n.Button,{variant:"link",onClick:()=>console.log("x")},(0,a.__)("Claim Credits","modula-best-grid-gallery")))))}function te(){return React.createElement(Yt,null)}function ee(){return React.createElement(React.Fragment,null,React.createElement(n.__experimentalSpacer,{marginTop:4,marginBottom:4}),React.createElement(n.Card,null,React.createElement(n.CardHeader,null,React.createElement("h2",null,(0,a.__)("AI Optimizer","modula-best-grid-gallery"))),React.createElement(n.CardBody,null,React.createElement(te,null))))}var se=class extends J{constructor(t={}){super(),this.config=t,this.#L=new Map}#L;build(t,e,s){const i=e.queryKey,r=e.queryHash??ot(i,e);let n=this.get(r);return n||(n=new Pt({cache:this,queryKey:i,queryHash:r,options:t.defaultQueryOptions(e),state:s,defaultOptions:t.getQueryDefaults(i)}),this.add(n)),n}add(t){this.#L.has(t.queryHash)||(this.#L.set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const e=this.#L.get(t.queryHash);e&&(t.destroy(),e===t&&this.#L.delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){Mt.batch((()=>{this.getAll().forEach((t=>{this.remove(t)}))}))}get(t){return this.#L.get(t)}getAll(){return[...this.#L.values()]}find(t){const e={exact:!0,...t};return this.getAll().find((t=>nt(e,t)))}findAll(t={}){const e=this.getAll();return Object.keys(t).length>0?e.filter((e=>nt(t,e))):e}notify(t){Mt.batch((()=>{this.listeners.forEach((e=>{e(t)}))}))}onFocus(){Mt.batch((()=>{this.getAll().forEach((t=>{t.onFocus()}))}))}onOnline(){Mt.batch((()=>{this.getAll().forEach((t=>{t.onOnline()}))}))}},ie=class extends J{constructor(t={}){super(),this.config=t,this.#B=new Set,this.#K=new Map,this.#G=0}#B;#K;#G;build(t,e,s){const i=new Zt({mutationCache:this,mutationId:++this.#G,options:t.defaultMutationOptions(e),state:s});return this.add(i),i}add(t){this.#B.add(t);const e=re(t);if("string"==typeof e){const s=this.#K.get(e);s?s.push(t):this.#K.set(e,[t])}this.notify({type:"added",mutation:t})}remove(t){if(this.#B.delete(t)){const e=re(t);if("string"==typeof e){const s=this.#K.get(e);if(s)if(s.length>1){const e=s.indexOf(t);-1!==e&&s.splice(e,1)}else s[0]===t&&this.#K.delete(e)}}this.notify({type:"removed",mutation:t})}canRun(t){const e=re(t);if("string"==typeof e){const s=this.#K.get(e),i=s?.find((t=>"pending"===t.state.status));return!i||i===t}return!0}runNext(t){const e=re(t);if("string"==typeof e){const s=this.#K.get(e)?.find((e=>e!==t&&e.state.isPaused));return s?.continue()??Promise.resolve()}return Promise.resolve()}clear(){Mt.batch((()=>{this.#B.forEach((t=>{this.notify({type:"removed",mutation:t})})),this.#B.clear(),this.#K.clear()}))}getAll(){return Array.from(this.#B)}find(t){const e={exact:!0,...t};return this.getAll().find((t=>at(e,t)))}findAll(t={}){return this.getAll().filter((e=>at(t,e)))}notify(t){Mt.batch((()=>{this.listeners.forEach((e=>{e(t)}))}))}resumePausedMutations(){const t=this.getAll().filter((t=>t.state.isPaused));return Mt.batch((()=>Promise.all(t.map((t=>t.continue().catch(tt))))))}};function re(t){return t.options.scope?.id}function ne(t){return{onFetch:(e,s)=>{const i=e.options,r=e.fetchOptions?.meta?.fetchMore?.direction,n=e.state.data?.pages||[],a=e.state.data?.pageParams||[];let o={pages:[],pageParams:[]},u=0;const l=async()=>{let s=!1;const l=gt(e.options,e.fetchOptions),c=async(t,i,r)=>{if(s)return Promise.reject();if(null==i&&t.pages.length)return Promise.resolve(t);const n={queryKey:e.queryKey,pageParam:i,direction:r?"backward":"forward",meta:e.options.meta};var a;a=n,Object.defineProperty(a,"signal",{enumerable:!0,get:()=>(e.signal.aborted?s=!0:e.signal.addEventListener("abort",(()=>{s=!0})),e.signal)});const o=await l(n),{maxPages:u}=e.options,c=r?mt:yt;return{pages:c(t.pages,o,u),pageParams:c(t.pageParams,i,u)}};if(r&&n.length){const t="backward"===r,e={pages:n,pageParams:a},s=(t?oe:ae)(i,e);o=await c(e,s,t)}else{const e=t??n.length;do{const t=0===u?a[0]??i.initialPageParam:ae(i,o);if(u>0&&null==t)break;o=await c(o,t),u++}while(u<e)}return o};e.options.persister?e.fetchFn=()=>e.options.persister?.(l,{queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},s):e.fetchFn=l}}}function ae(t,{pages:e,pageParams:s}){const i=e.length-1;return e.length>0?t.getNextPageParam(e[i],e,s[i],s):void 0}function oe(t,{pages:e,pageParams:s}){return e.length>0?t.getPreviousPageParam?.(e[0],e,s[0],s):void 0}const ue=new class{#$;#_;#l;#H;#N;#W;#z;#X;constructor(t={}){this.#$=t.queryCache||new se,this.#_=t.mutationCache||new ie,this.#l=t.defaultOptions||{},this.#H=new Map,this.#N=new Map,this.#W=0}mount(){this.#W++,1===this.#W&&(this.#z=St.subscribe((async t=>{t&&(await this.resumePausedMutations(),this.#$.onFocus())})),this.#X=wt.subscribe((async t=>{t&&(await this.resumePausedMutations(),this.#$.onOnline())})))}unmount(){this.#W--,0===this.#W&&(this.#z?.(),this.#z=void 0,this.#X?.(),this.#X=void 0)}isFetching(t){return this.#$.findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return this.#_.findAll({...t,status:"pending"}).length}getQueryData(t){const e=this.defaultQueryOptions({queryKey:t});return this.#$.get(e.queryHash)?.state.data}ensureQueryData(t){const e=this.defaultQueryOptions(t),s=this.#$.build(this,e),i=s.state.data;return void 0===i?this.fetchQuery(t):(t.revalidateIfStale&&s.isStaleByTime(it(e.staleTime,s))&&this.prefetchQuery(e),Promise.resolve(i))}getQueriesData(t){return this.#$.findAll(t).map((({queryKey:t,state:e})=>[t,e.data]))}setQueryData(t,e,s){const i=this.defaultQueryOptions({queryKey:t}),r=this.#$.get(i.queryHash),n=r?.state.data,a=function(t,e){return"function"==typeof t?t(e):t}(e,n);if(void 0!==a)return this.#$.build(this,i).setData(a,{...s,manual:!0})}setQueriesData(t,e,s){return Mt.batch((()=>this.#$.findAll(t).map((({queryKey:t})=>[t,this.setQueryData(t,e,s)]))))}getQueryState(t){const e=this.defaultQueryOptions({queryKey:t});return this.#$.get(e.queryHash)?.state}removeQueries(t){const e=this.#$;Mt.batch((()=>{e.findAll(t).forEach((t=>{e.remove(t)}))}))}resetQueries(t,e){const s=this.#$,i={type:"active",...t};return Mt.batch((()=>(s.findAll(t).forEach((t=>{t.reset()})),this.refetchQueries(i,e))))}cancelQueries(t,e={}){const s={revert:!0,...e},i=Mt.batch((()=>this.#$.findAll(t).map((t=>t.cancel(s)))));return Promise.all(i).then(tt).catch(tt)}invalidateQueries(t,e={}){return Mt.batch((()=>{if(this.#$.findAll(t).forEach((t=>{t.invalidate()})),"none"===t?.refetchType)return Promise.resolve();const s={...t,type:t?.refetchType??t?.type??"active"};return this.refetchQueries(s,e)}))}refetchQueries(t,e={}){const s={...e,cancelRefetch:e.cancelRefetch??!0},i=Mt.batch((()=>this.#$.findAll(t).filter((t=>!t.isDisabled())).map((t=>{let e=t.fetch(void 0,s);return s.throwOnError||(e=e.catch(tt)),"paused"===t.state.fetchStatus?Promise.resolve():e}))));return Promise.all(i).then(tt)}fetchQuery(t){const e=this.defaultQueryOptions(t);void 0===e.retry&&(e.retry=!1);const s=this.#$.build(this,e);return s.isStaleByTime(it(e.staleTime,s))?s.fetch(e):Promise.resolve(s.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(tt).catch(tt)}fetchInfiniteQuery(t){return t.behavior=ne(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(tt).catch(tt)}ensureInfiniteQueryData(t){return t.behavior=ne(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return wt.isOnline()?this.#_.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#$}getMutationCache(){return this.#_}getDefaultOptions(){return this.#l}setDefaultOptions(t){this.#l=t}setQueryDefaults(t,e){this.#H.set(ut(t),{queryKey:t,defaultOptions:e})}getQueryDefaults(t){const e=[...this.#H.values()],s={};return e.forEach((e=>{lt(t,e.queryKey)&&Object.assign(s,e.defaultOptions)})),s}setMutationDefaults(t,e){this.#N.set(ut(t),{mutationKey:t,defaultOptions:e})}getMutationDefaults(t){const e=[...this.#N.values()];let s={};return e.forEach((e=>{lt(t,e.mutationKey)&&(s={...s,...e.defaultOptions})})),s}defaultQueryOptions(t){if(t._defaulted)return t;const e={...this.#l.queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return e.queryHash||(e.queryHash=ot(e.queryKey,e)),void 0===e.refetchOnReconnect&&(e.refetchOnReconnect="always"!==e.networkMode),void 0===e.throwOnError&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===bt&&(e.enabled=!1),e}defaultMutationOptions(t){return t?._defaulted?t:{...this.#l.mutations,...t?.mutationKey&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){this.#$.clear(),this.#_.clear()}},le=(t,e)=>{switch(e.type){case"UPDATE_SETTINGS":return{...t,settings:e.payload};case"TOGGLE_ADVANCED_REGISTRATION":return{...t,isAdvancedRegistration:e.payload};case"SET_LOGGED_IN":return{...t,isLoggedIn:e.payload};default:return t}},ce={api_key:"",isAdvancedRegistration:!1,isLoggedIn:!1},he=(0,r.createContext)(ce),de=({children:t})=>{const[e,s]=(0,r.useReducer)(le,ce),i={state:e,dispatch:s};return React.createElement(he.Provider,{value:i},t)};document.addEventListener("DOMContentLoaded",(()=>{const t=document.getElementById("modula-ai-settings");t&&(0,r.createRoot)(t).render(React.createElement(kt,{client:ue},React.createElement(de,null,React.createElement(ee,null))))}))})();