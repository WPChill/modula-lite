wp.Modula=void 0===wp.Modula?{}:wp.Modula,function(e,t){var i=Backbone.Model.extend({defaults:{columns:12,gutter:10,containerSize:!1,size:!1},initialize:function(t){var i=this;this.set("containerSize",jQuery("#modula-uploader-container .modula-uploader-inline-content").width()),this.set("gutter",parseInt(wp.Modula.Settings.get("gutter"))),this.generateSize(),this.listenTo(wp.Modula.Settings,"change:gutter",this.changeGutter),jQuery(window).on("resize",e.proxy(this.windowResize,this)),new ModulaResizeSensor(jQuery("#modula-uploader-container .modula-uploader-inline-content"),(function(){i.windowResize()}))},generateSize:function(){var e,t=this.get("columns"),i=this.get("gutter"),r=this.get("containerSize");e=Math.floor((r-i*(t-1))/t),this.set("size",e)},calculateSize:function(e){var t=this.get("size"),i=Math.round(e/t),r=this.get("gutter"),s=this.get("columns");return i>s&&(i=s),t*i+r*(i-1)},getSizeColumns:function(e){var t=this.get("size");return Math.round(e/t)},windowResize:function(){var e=this.get("containerSize"),t=jQuery("#modula-uploader-container .modula-uploader-inline-content").width();e!=t&&(this.set("containerSize",t),this.resizeItems())},resizeItems:function(){this.generateSize(),void 0!==wp.Modula.Items&&wp.Modula.Items.length>0&&wp.Modula.Items.each((function(e){e.resize()})),"custom-grid"==t.Settings.get("type")&&(wp.Modula.GalleryView.setPackaryOption("columnWidth",this.get("size")),wp.Modula.GalleryView.setPackaryOption("rowHeight",this.get("size")),wp.Modula.GalleryView.setPackaryOption("gutter",parseInt(this.get("gutter"))),wp.Modula.GalleryView.resetPackary())},changeColumns:function(e,t){this.set("columns",t),this.resizeItems()},changeGutter:function(e,t){this.set("gutter",parseInt(t)),this.resizeItems()}}),r=Backbone.View.extend({isSortable:!1,isResizeble:!1,refreshTimeout:!1,updateIndexTimeout:!1,backboneInstance:this,initialize:function(t){this.container=this.$el.find(".modula-uploader-inline-content"),this.helperGridContainer=this.$el.parent().find(".modula-helper-guidelines-container"),this.helperGrid=this.$el.find("#modula-grid"),this.helperGridContainer.on("change","input",e.proxy(this.updateSettings,this)),this.listenTo(wp.Modula.Settings,"change:type",this.checkSettingsType),this.checkGalleryType(wp.Modula.Settings.get("type")),this.gridView=new wp.Modula.previewer.helpergrid({el:this.$el.find("#modula-grid"),galleryView:this})},updateSettings:function(e){var t;e.target.dataset.setting;t=e.target.checked?1:0,wp.Modula.Settings.set("helpergrid",t),t?this.helperGrid.hide():this.helperGrid.show()},checkSettingsType:function(e,t){this.checkGalleryType(t)},checkGalleryType:function(e){"creative-gallery"==e||"grid"==e?(this.isResizeble&&this.disableResizeble(),this.isSortable||this.enableSortable(),this.helperGridContainer.addClass("modula-guidelines-display"),this.helperGridContainer.find(".modula-helper-guidelines-wrapper").hide(),this.container.removeClass("modula-custom-grid").addClass("modula-creative-gallery")):"custom-grid"==e?(this.isSortable&&this.disableSortable(),this.isResizeble||this.enableResizeble(),this.helperGridContainer.find(".modula-helper-guidelines-wrapper").show(),this.helperGridContainer.removeClass("modula-guidelines-display"),wp.Modula.Settings.get("helpergrid")||this.helperGrid.show(),this.container.removeClass("modula-creative-gallery").addClass("modula-custom-grid")):jQuery(document).trigger("modula_gallery_type_check",[this,this.backboneInstance,e])},enableSortable:function(){var t=this;this.isSortable=!0,this.container.sortable({items:".modula-single-image",cursor:"move",forcePlaceholderSize:!0,placeholder:"modula-single-image-placeholder",stop:function(i,r){t.container.sortable("toArray").forEach((function(t,i){e("#"+t).trigger("modula:updateIndex",{index:i})}))}})},disableSortable:function(){this.isSortable=!1,this.container.sortable("destroy")},enableResizeble:function(){this.isResizeble=!0,this.$el.addClass("modula-resizer-enabled"),void 0===wp.Modula.Resizer&&(wp.Modula.Resizer=new wp.Modula.previewer.resizer({galleryView:this})),this.container.packery({itemSelector:".modula-single-image",gutter:parseInt(wp.Modula.Resizer.get("gutter")),columnWidth:wp.Modula.Resizer.get("size"),rowHeight:wp.Modula.Resizer.get("size")}),this.container.on("layoutComplete",this.updateItemsIndex),this.container.on("dragItemPositioned",this.updateItemsIndex)},disableResizeble:function(){this.isResizeble=!1,this.$el.removeClass("modula-resizer-enabled"),this.container.packery("destroy")},bindDraggabillyEvents:function(e){this.isResizeble&&this.container.packery("bindUIDraggableEvents",e)},resetPackary:function(){var e=this;this.refreshTimeout&&clearTimeout(this.refreshTimeout),this.refreshTimeout=setTimeout((function(){e.container.packery()}),200)},updateItemsIndex:function(){var t=this;this.updateIndexTimeout&&clearTimeout(this.updateIndexTimeout),this.updateIndexTimeout=setTimeout((function(){var i=e(t).packery("getItemElements");e(i).each((function(t,i){e(i).trigger("modula:updateIndex",{index:t})}))}),200)},setPackaryOption:function(e,t){var i=this.container.data("packery");void 0!==i&&(i.options[e]=t)}}),s=Backbone.View.extend({containerHeight:0,currentRows:0,updateGridTimeout:!1,initialize:function(e){var t=this;this.galleryView=e.galleryView,void 0===wp.Modula.Resizer&&(wp.Modula.Resizer=new wp.Modula.previewer.resizer({galleryView:this.galleryView})),this.containerHeight=this.galleryView.container.height(),this.listenTo(wp.Modula.Settings,"change:type",this.checkSettingsType),this.listenTo(wp.Modula.Settings,"change:gutter",this.changeGutter),this.listenTo(wp.Modula.Resizer,"change:size",this.updateGrid),this.galleryView.container.on("layoutComplete",(function(e){t.updateGrid()})),this.checkGalleryType(wp.Modula.Settings.get("type"))},checkSettingsType:function(e,t){this.checkGalleryType(t)},checkGalleryType:function(e){"creative-gallery"==e||"grid"==e?this.$el.hide():"custom-grid"==e&&(wp.Modula.Settings.get("helpergrid")||this.$el.show(),this.generateGrid())},generateGrid:function(){var t,i,r=wp.Modula.Resizer.get("size"),s=wp.Modula.Resizer.get("gutter"),a=0,n=0,o=0,l=this.$el.parent().height();for((o=this.$el.height())<(i=3*(r+s)-s)&&(o=i),n=(t=Math.round((o+s)/(r+s))+1)*(r+s)-s;o<n;)n-=r+s;if(this.$el.height(n),e("#modula-uploader-container").css("min-height",i+"px"),n>l&&this.$el.parent().height(n),t>this.currentRows){a=12*(t-this.currentRows),this.currentRows=t;for(var h=1;h<=a;h++)this.$el.append('<div class="modula-grid-item"></div>');this.$el.find(".modula-grid-item").css({width:r,height:r,"margin-right":s,"margin-bottom":s})}},updateGrid:function(){var t,i,r=wp.Modula.Resizer.get("size"),s=wp.Modula.Resizer.get("gutter"),a=0,n=0,o=this.galleryView.container.data("packery"),l=this.$el.parent().height();if(void 0!==o){for(n=o.maxY-o.gutter,minContainerHeight=3*(r+s)-s,n<minContainerHeight&&(n=minContainerHeight),a=(t=Math.round((n+s)/(r+s))+1)*(r+s)-s;n<a;)a-=r+s;this.$el.height(a),e("#modula-uploader-container").css("min-height",minContainerHeight+"px"),a>l&&this.$el.parent().height(a),i=12*(t-this.currentRows),this.currentRows=t;for(var h=1;h<=i;h++)this.$el.append('<div class="modula-grid-item"></div>');this.$el.find(".modula-grid-item").css({width:r,height:r,"margin-right":s,"margin-bottom":s})}},changeGutter:function(){var e=wp.Modula.Resizer.get("size"),t=wp.Modula.Resizer.get("gutter"),i=0,r=0,s=this.galleryView.container.data("packery");if(void 0!==s){for((r=s.maxY-s.gutter)<300&&(r=300),i=(Math.round((r+t)/(e+t))+1)*(e+t)-t;r<i;)i-=e+t;this.$el.height(i),this.$el.find(".modula-grid-item").css({width:e,height:e,"margin-right":t,"margin-bottom":t})}}});t.previewer={resizer:i,helpergrid:s,view:r}}(jQuery,wp.Modula);