wp.Modula=void 0===wp.Modula?{}:wp.Modula,function(e,i){var t=Backbone.Model.extend({defaults:{columns:12,gutter:10,containerSize:!1,size:!1},initialize:function(i){var t=this;this.set("containerSize",jQuery("#modula-uploader-container .modula-uploader-inline-content").width()),this.set("gutter",parseInt(wp.Modula.Settings.get("gutter"))),this.generateSize(),this.listenTo(wp.Modula.Settings,"change:gutter",this.changeGutter),jQuery(window).on("resize",e.proxy(this.windowResize,this)),new ModulaResizeSensor(jQuery("#modula-uploader-container .modula-uploader-inline-content"),(function(){t.windowResize()}))},generateSize:function(){var e,i=this.get("columns"),t=this.get("gutter"),r=this.get("containerSize");e=Math.floor((r-t*(i-1))/i),this.set("size",e)},calculateSize:function(e){var i=this.get("size"),t=Math.round(e/i),r=this.get("gutter"),n=this.get("columns");return t>n&&(t=n),i*t+r*(t-1)},getSizeColumns:function(e){var i=this.get("size");return Math.round(e/i)},windowResize:function(){var e=this.get("containerSize"),i=jQuery("#modula-uploader-container .modula-uploader-inline-content").width();e!=i&&(this.set("containerSize",i),this.resizeItems())},resizeItems:function(){this.generateSize(),void 0!==wp.Modula.Items&&wp.Modula.Items.length>0&&wp.Modula.Items.each((function(e){e.resize()})),"custom-grid"==i.Settings.get("type")&&(wp.Modula.GalleryView.setPackaryOption("columnWidth",this.get("size")),wp.Modula.GalleryView.setPackaryOption("rowHeight",this.get("size")),wp.Modula.GalleryView.setPackaryOption("gutter",parseInt(this.get("gutter"))),wp.Modula.GalleryView.resetPackary())},changeColumns:function(e,i){this.set("columns",i),this.resizeItems()},changeGutter:function(e,i){this.set("gutter",parseInt(i)),this.resizeItems()}}),r=Backbone.View.extend({isSortable:!1,isResizeble:!1,refreshTimeout:!1,updateIndexTimeout:!1,backboneInstance:this,initialize:function(i){this.container=this.$el.find(".modula-uploader-inline-content"),this.helperGridContainer=this.$el.parent().find(".modula-helper-guidelines-container"),this.helperGrid=this.$el.find("#modula-grid"),this.helperGridContainer.on("change","input",e.proxy(this.updateSettings,this)),this.listenTo(wp.Modula.Settings,"change:type",this.checkSettingsType),this.checkGalleryType(wp.Modula.Settings.get("type")),this.gridView=new wp.Modula.previewer.helpergrid({el:this.$el.find("#modula-grid"),galleryView:this})},updateSettings:function(e){var i;e.target.dataset.setting;i=e.target.checked?1:0,wp.Modula.Settings.set("helpergrid",i),i?this.helperGrid.hide():this.helperGrid.show()},checkSettingsType:function(e,i){this.checkGalleryType(i)},checkGalleryType:function(e){"creative-gallery"==e||"grid"==e?(this.isResizeble&&this.disableResizeble(),this.isSortable||this.enableSortable(),this.helperGridContainer.addClass("modula-guidelines-display"),this.helperGridContainer.find(".modula-helper-guidelines-wrapper").hide(),this.container.removeClass("modula-custom-grid").addClass("modula-creative-gallery")):"custom-grid"==e?(this.isSortable&&this.disableSortable(),this.isResizeble||this.enableResizeble(),this.helperGridContainer.find(".modula-helper-guidelines-wrapper").show(),this.helperGridContainer.removeClass("modula-guidelines-display"),wp.Modula.Settings.get("helpergrid")||this.helperGrid.show(),this.container.removeClass("modula-creative-gallery").addClass("modula-custom-grid")):jQuery(document).trigger("modula_gallery_type_check",[this,this.backboneInstance,e])},enableSortable:function(){var i=this;this.isSortable=!0,this.container.sortable({items:".modula-single-image",cursor:"move",forcePlaceholderSize:!0,placeholder:"modula-single-image-placeholder",stop:function(t,r){i.container.sortable("toArray").forEach((function(i,t){e("#"+i).trigger("modula:updateIndex",{index:t})}))}})},disableSortable:function(){this.isSortable=!1,this.container.sortable("destroy")},enableResizeble:function(){this.isResizeble=!0,this.$el.addClass("modula-resizer-enabled"),void 0===wp.Modula.Resizer&&(wp.Modula.Resizer=new wp.Modula.previewer.resizer({galleryView:this})),this.container.packery({itemSelector:".modula-single-image",gutter:parseInt(wp.Modula.Resizer.get("gutter")),columnWidth:wp.Modula.Resizer.get("size"),rowHeight:wp.Modula.Resizer.get("size")}),this.container.on("layoutComplete",this.updateItemsIndex),this.container.on("dragItemPositioned",this.updateItemsIndex)},disableResizeble:function(){this.isResizeble=!1,this.$el.removeClass("modula-resizer-enabled"),this.container.packery("destroy")},bindDraggabillyEvents:function(e){this.isResizeble&&this.container.packery("bindUIDraggableEvents",e)},resetPackary:function(){var e=this;this.refreshTimeout&&clearTimeout(this.refreshTimeout),this.refreshTimeout=setTimeout((function(){e.container.packery()}),200)},updateItemsIndex:function(){var i=this;this.updateIndexTimeout&&clearTimeout(this.updateIndexTimeout),this.updateIndexTimeout=setTimeout((function(){var t=e(i).packery("getItemElements");e(t).each((function(i,t){e(t).trigger("modula:updateIndex",{index:i})}))}),200)},setPackaryOption:function(e,i){var t=this.container.data("packery");void 0!==t&&(t.options[e]=i)},removeView:function(){this.remove(),this.unbind(),this.off()},reinitialize:function(e){this.removeView(),this.initialize(e)}}),n=Backbone.View.extend({containerHeight:0,currentRows:0,updateGridTimeout:!1,initialize:function(e){var i=this;this.galleryView=e.galleryView,void 0===wp.Modula.Resizer&&(wp.Modula.Resizer=new wp.Modula.previewer.resizer({galleryView:this.galleryView})),this.containerHeight=this.galleryView.container.height(),this.listenTo(wp.Modula.Settings,"change:type",this.checkSettingsType),this.listenTo(wp.Modula.Settings,"change:gutter",this.changeGutter),this.listenTo(wp.Modula.Resizer,"change:size",this.updateGrid),this.galleryView.container.on("layoutComplete",(function(e){i.updateGrid()})),this.checkGalleryType(wp.Modula.Settings.get("type"))},checkSettingsType:function(e,i){this.checkGalleryType(i)},checkGalleryType:function(e){"creative-gallery"==e||"grid"==e||"bnb"==e?this.$el.hide():"custom-grid"==e&&(wp.Modula.Settings.get("helpergrid")||this.$el.show(),this.generateGrid())},generateGrid:function(){var i,t,r=wp.Modula.Resizer.get("size"),n=wp.Modula.Resizer.get("gutter"),s=0,a=0,o=0,l=this.$el.parent().height();for((o=this.$el.height())<(t=3*(r+n)-n)&&(o=t),a=(i=Math.round((o+n)/(r+n))+1)*(r+n)-n;o<a;)a-=r+n;if(this.$el.height(a),e("#modula-uploader-container").css("min-height",t+"px"),a>l&&this.$el.parent().height(a),i>this.currentRows){s=12*(i-this.currentRows),this.currentRows=i;for(var h=1;h<=s;h++)this.$el.append('<div class="modula-grid-item"></div>');this.$el.find(".modula-grid-item").css({width:r,height:r,"margin-right":n,"margin-bottom":n})}},updateGrid:function(){var i,t,r=wp.Modula.Resizer.get("size"),n=wp.Modula.Resizer.get("gutter"),s=0,a=0,o=this.galleryView.container.data("packery"),l=this.$el.parent().height();if(void 0!==o){for(a=o.maxY-o.gutter,minContainerHeight=3*(r+n)-n,a<minContainerHeight&&(a=minContainerHeight),s=(i=Math.round((a+n)/(r+n))+1)*(r+n)-n;a<s;)s-=r+n;this.$el.height(s),e("#modula-uploader-container").css("min-height",minContainerHeight+"px"),s>l&&this.$el.parent().height(s),t=12*(i-this.currentRows),this.currentRows=i;for(var h=1;h<=t;h++)this.$el.append('<div class="modula-grid-item"></div>');this.$el.find(".modula-grid-item").css({width:r,height:r,"margin-right":n,"margin-bottom":n})}},changeGutter:function(){var e=wp.Modula.Resizer.get("size"),i=wp.Modula.Resizer.get("gutter"),t=0,r=0,n=this.galleryView.container.data("packery");if(void 0!==n){for((r=n.maxY-n.gutter)<300&&(r=300),t=(Math.round((r+i)/(e+i))+1)*(e+i)-i;r<t;)t-=e+i;this.$el.height(t),this.$el.find(".modula-grid-item").css({width:e,height:e,"margin-right":i,"margin-bottom":i})}}});i.previewer={resizer:t,helpergrid:n,view:r}}(jQuery,wp.Modula);